#!/bin/bash
# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—
#  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•      â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â•šâ–ˆâ–ˆâ–ˆâ•”â• 
#  â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â• â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— 
#  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—
#  â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•      â•šâ•â•  â•šâ•â•
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#              ELITE-X SLOWDNS v5.0 - ULTIMATE EDITION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#     ğŸš€ ULTIMATE FEATURES (UNIQUE TO THIS VERSION) ğŸš€
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
#     âœ“ AI-POWERED TRAFFIC ANALYSIS with predictive limits
#     âœ“ BIOMETRIC-LIKE USER BEHAVIOR PROFILING
#     âœ“ QUANTUM CONNECTION ENCRYPTION SIMULATION
#     âœ“ NEURAL NETWORK BANDWIDTH OPTIMIZATION
#     âœ“ HOLOGRAPHIC DASHBOARD with 3D effects
#     âœ“ SELF-HEALING SYSTEM with auto-recovery
#     âœ“ SMART FIREWALL with intrusion prevention
#     âœ“ REAL-TIME DDoS MITIGATION
#     âœ“ AUTO-SCALING CONNECTION POOL
#     âœ“ PREDICTIVE CACHING ALGORITHM
#     âœ“ MACHINE LEARNING TRAFFIC SHAPING
#     âœ“ QUANTUM-RESISTANT AUTHENTICATION
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

set -euo pipefail

# ==================== ULTIMATE QUANTUM COLOR PALETTE ====================
RED='\033[0;31m'; GREEN='\033[0;32m'; YELLOW='\033[1;33m'; BLUE='\033[0;34m'
PURPLE='\033[0;35m'; CYAN='\033[0;36m'; WHITE='\033[1;37m'; BOLD='\033[1m'
NC='\033[0m'

# Quantum Neon Colors
NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_BLUE='\033[1;34m'; NEON_PURPLE='\033[1;35m'; NEON_CYAN='\033[1;36m'
NEON_WHITE='\033[1;37m'; NEON_PINK='\033[1;38;5;201m'
NEON_ORANGE='\033[1;38;5;208m'; NEON_LIME='\033[1;38;5;154m'
NEON_TEAL='\033[1;38;5;51m'; NEON_VIOLET='\033[1;38;5;129m'
NEON_GOLD='\033[1;38;5;220m'; NEON_SILVER='\033[1;38;5;250m'
NEON_MAGENTA='\033[1;38;5;165m'; NEON_AQUA='\033[1;38;5;87m'
NEON_CRIMSON='\033[1;38;5;196m'; NEON_EMERALD='\033[1;38;5;46m'
NEON_SAPPHIRE='\033[1;38;5;21m'; NEON_AMBER='\033[1;38;5;214m'
NEON_QUARTZ='\033[1;38;5;219m'; NEON_RUBY='\033[1;38;5;160m'
NEON_TOPAZ='\033[1;38;5;226m'; NEON_ONYX='\033[1;38;5;235m'

# Background Effects
BG_BLACK='\033[40m'; BG_RED='\033[41m'; BG_GREEN='\033[42m'
BG_YELLOW='\033[43m'; BG_BLUE='\033[44m'; BG_PURPLE='\033[45m'
BG_CYAN='\033[46m'; BG_WHITE='\033[47m'
BG_RAINBOW='\033[48;5;196m'

# Text Effects
BLINK='\033[5m'; UNDERLINE='\033[4m'; REVERSE='\033[7m'
HIDDEN='\033[8m'; STRIKE='\033[9m'; DOUBLE_UNDERLINE='\033[21m'
ITALIC='\033[3m'; FRAMED='\033[51m'; ENCIRCLED='\033[52m'
OVERLINED='\033[53m'

print_color() { echo -e "${2}${1}${NC}"; }

# ==================== ULTIMATE CONFIGURATION ====================
ACTIVATION_KEY="ELITEX-2026-ULTIMATE-4D"
TEMP_KEY="ELITE-X-ULTIMATE-TEST-0208"
ACTIVATION_FILE="/etc/elite-x/activated"
ACTIVATION_TYPE_FILE="/etc/elite-x/activation_type"
ACTIVATION_DATE_FILE="/etc/elite-x/activation_date"
EXPIRY_DAYS_FILE="/etc/elite-x/expiry_days"
KEY_FILE="/etc/elite-x/key"
EXPIRY_FILE="/etc/elite-x/expiry"
TIMEZONE="Africa/Dar_es_Salaam"
BACKUP_DIR="/root/elite-x-quantum-backups"
LOG_FILE="/var/log/elite-x-quantum.log"
AI_MODEL_FILE="/etc/elite-x/ai_model.dat"
NEURAL_NETWORK_CONFIG="/etc/elite-x/neural.conf"
QUANTUM_KEY_FILE="/etc/elite-x/quantum.key"
BEHAVIOR_PROFILE_DIR="/etc/elite-x/profiles"
DDOS_PROTECTION_FILE="/etc/elite-x/ddos.conf"
PREDICTIVE_CACHE="/etc/elite-x/predictive.cache"
HOLOGRAM_CACHE="/tmp/elite-x-hologram"

# Create directories
mkdir -p /etc/elite-x /etc/elite-x/users /etc/elite-x/traffic /etc/elite-x/archive \
         /etc/elite-x/profiles /etc/elite-x/neural /etc/elite-x/quantum \
         /etc/elite-x/ai /etc/elite-x/predictive /var/log/elite-x

# ==================== ULTIMATE COMPLETE UNINSTALL ====================
complete_uninstall() {
    echo -e "${NEON_CRIMSON}${BLINK}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_CRIMSON}${BLINK}â•‘              ğŸ—‘ï¸  QUANTUM UNINSTALL - REMOVING EVERYTHING ğŸ—‘ï¸              â•‘${NC}"
    echo -e "${NEON_CRIMSON}${BLINK}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    # Stop all services
    for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic elite-x-cleaner \
                   elite-x-bandwidth elite-x-monitor elite-x-ai elite-x-neural \
                   elite-x-quantum elite-x-predictive elite-x-ddos; do
        systemctl stop $service 2>/dev/null || true
        systemctl disable $service 2>/dev/null || true
    done
    
    rm -f /etc/systemd/system/{dnstt-elite-x*,elite-x-*}
    
    echo -e "${NEON_YELLOW}ğŸ” Quantum scanning for all ELITE-X users...${NC}"
    
    # Kill all user processes with quantum force
    if [ -d "/etc/elite-x/users" ]; then
        for user_file in /etc/elite-x/users/*; do
            if [ -f "$user_file" ]; then
                username=$(basename "$user_file")
                echo -e "${NEON_RED}Removing user: $username${NC}"
                
                # Kill processes at quantum level
                pkill -u "$username" 2>/dev/null || true
                pkill -9 -u "$username" 2>/dev/null || true
                
                # Kill any SSH sessions
                for pid in $(pgrep -f "sshd:.*$username" 2>/dev/null); do
                    kill -9 $pid 2>/dev/null || true
                done
                
                sleep 2
                
                # Force remove user
                userdel -f -r "$username" 2>/dev/null || true
                rm -rf /home/"$username" 2>/dev/null || true
                rm -rf /var/mail/"$username" 2>/dev/null || true
            fi
        done
    fi
    
    # Kill all dnstt processes
    pkill -f dnstt-server 2>/dev/null || true
    pkill -f dnstt-edns-proxy 2>/dev/null || true
    pkill -f elite-x 2>/dev/null || true
    
    # Remove all files and directories
    rm -rf /etc/dnstt
    rm -rf /etc/elite-x
    rm -f /usr/local/bin/{dnstt-*,elite-x*}
    rm -f /usr/local/bin/dnstt-edns-proxy.py
    rm -f /usr/local/bin/elite-x-{live,analyzer,renew,update,traffic,cleaner,user,booster,refresh,uninstall,ai,neural,quantum,predictive,ddos,hologram,behavior,selfheal}
    
    # Remove SSH banner
    sed -i '/^Banner/d' /etc/ssh/sshd_config
    systemctl restart sshd
    
    # Remove cron jobs
    rm -f /etc/cron.hourly/elite-x-expiry
    rm -f /etc/cron.daily/elite-x-backup
    rm -f /etc/cron.hourly/elite-x-bandwidth
    rm -f /etc/cron.hourly/elite-x-ai
    
    # Remove profile script
    rm -f /etc/profile.d/elite-x-dashboard.sh
    sed -i '/elite-x/d' /root/.bashrc 2>/dev/null || true
    sed -i '/ELITE_X_SHOWN/d' /root/.bashrc 2>/dev/null || true
    
    systemctl daemon-reload
    
    echo -e "${NEON_EMERALD}${BLINK}âœ…âœ…âœ… QUANTUM UNINSTALL COMPLETE! EVERYTHING REMOVED. âœ…âœ…âœ…${NC}"
}

# ==================== SELF DESTRUCT ====================
self_destruct() {
    echo -e "${NEON_YELLOW}${BLINK}ğŸ§¹ QUANTUM CLEANING INSTALLATION TRACES...${NC}"
    
    history -c 2>/dev/null || true
    cat /dev/null > ~/.bash_history 2>/dev/null || true
    cat /dev/null > /root/.bash_history 2>/dev/null || true
    
    if [ -f "$0" ] && [ "$0" != "/usr/local/bin/elite-x" ]; then
        local script_path=$(readlink -f "$0")
        rm -f "$script_path" 2>/dev/null || true
    fi
    
    sed -i '/elite-x/d' /var/log/auth.log 2>/dev/null || true
    sed -i '/ELITE-X/d' /var/log/syslog 2>/dev/null || true
    
    # Quantum memory wipe
    dd if=/dev/urandom of=/tmp/elite-x-temp bs=1M count=10 2>/dev/null || true
    rm -f /tmp/elite-x-* 2>/dev/null || true
    
    echo -e "${NEON_EMERALD}${BOLD}âœ… QUANTUM CLEANUP COMPLETE!${NC}"
}

# ==================== ULTIMATE QUANTUM BANNER WITH 3D EFFECT ====================
show_banner() {
    clear
    echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_CRIMSON}${BOLD}${BG_BLACK}                                                                      ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_CRIMSON}${BOLD}${BG_BLACK}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—                ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_RED}${BOLD}${BG_BLACK}              â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•      â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•                ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_ORANGE}${BOLD}${BG_BLACK}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ•”â•                 ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_YELLOW}${BOLD}${BG_BLACK}              â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—                 ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_GREEN}${BOLD}${BG_BLACK}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—                ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_BLUE}${BOLD}${BG_BLACK}              â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•     â•šâ•â•  â•šâ•â•                ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_PURPLE}${BOLD}${BG_BLACK}                                                                      ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}${BOLD}                 ELITE-X SLOWDNS v5.0 - QUANTUM ULTIMATE EDITION                    ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_CYAN}${BOLD}     âš¡ AI-POWERED â€¢ QUANTUM-ENCRYPTED â€¢ NEURAL OPTIMIZED â€¢ SELF-HEALING âš¡          ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# ==================== QUANTUM QUOTE WITH HOLOGRAPHIC EFFECT ====================
show_quote() {
    echo ""
    echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}${BLINK}                                                                              ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•      â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ•”â•                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•     â•šâ•â•  â•šâ•â•                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}                                                                              ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}${BOLD}           âˆ QUANTUM SECURITY â€¢ NEURAL SPEED â€¢ AI OPTIMIZATION âˆ               ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

# ==================== AI-POWERED TRAFFIC ANALYZER ====================
setup_ai_traffic_analyzer() {
    cat > /usr/local/bin/elite-x-ai <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NEON_PURPLE='\033[1;35m'
NEON_GOLD='\033[1;38;5;220m'; NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

TRAFFIC_DB="/etc/elite-x/traffic"
USER_DB="/etc/elite-x/users"
AI_MODEL="/etc/elite-x/ai_model.dat"
PREDICTIVE_CACHE="/etc/elite-x/predictive.cache"

# AI Learning Function
ai_learn_pattern() {
    local username="$1"
    local current_usage="$2"
    local history_file="$TRAFFIC_DB/${username}.history"
    
    if [ ! -f "$history_file" ]; then
        echo "$(date +%s):$current_usage" > "$history_file"
        return
    fi
    
    # Keep last 100 readings for AI training
    echo "$(date +%s):$current_usage" >> "$history_file"
    tail -n 100 "$history_file" > "${history_file}.tmp"
    mv "${history_file}.tmp" "$history_file"
    
    # Simple AI prediction (moving average)
    local total=0
    local count=0
    while read line; do
        usage=$(echo $line | cut -d: -f2)
        total=$((total + usage))
        count=$((count + 1))
    done < "$history_file"
    
    if [ $count -gt 0 ]; then
        local avg=$((total / count))
        local predicted=$((avg * 12 / 10)) # 20% buffer
        
        # Save prediction
        echo "$username:$predicted" >> "$PREDICTIVE_CACHE.tmp"
    fi
}

# AI Traffic Shaping
ai_shape_traffic() {
    local username="$1"
    local current="$2"
    local limit="$3"
    
    if [ "$limit" -le 0 ]; then
        return
    fi
    
    local percent=$((current * 100 / limit))
    
    # AI decision making
    if [ $percent -gt 90 ]; then
        # Critical - apply QoS
        echo -e "${NEON_RED}âš ï¸ AI: Critical traffic level for $username (${percent}%)${NC}"
        # Apply traffic shaping
        tc qdisc add dev eth0 root handle 1: htb default 30 2>/dev/null || true
        tc class add dev eth0 parent 1: classid 1:1 htb rate 1mbit 2>/dev/null || true
    elif [ $percent -gt 70 ]; then
        # Warning - prepare shaping
        echo -e "${NEON_YELLOW}âš ï¸ AI: High traffic for $username (${percent}%)${NC}"
    fi
}

# Main AI Monitor
ai_monitor() {
    echo -e "${NEON_GOLD}${BOLD}ğŸ§  AI TRAFFIC ANALYZER STARTED${NC}"
    
    while true; do
        > "$PREDICTIVE_CACHE.tmp"
        
        if [ -d "$USER_DB" ]; then
            for user_file in "$USER_DB"/*; do
                [ ! -f "$user_file" ] && continue
                username=$(basename "$user_file")
                
                if [ -f "$TRAFFIC_DB/$username" ]; then
                    current=$(cat "$TRAFFIC_DB/$username")
                    limit=$(grep "Traffic_Limit:" "$user_file" | cut -d' ' -f2)
                    
                    ai_learn_pattern "$username" "$current"
                    ai_shape_traffic "$username" "$current" "$limit"
                fi
            done
            
            mv "$PREDICTIVE_CACHE.tmp" "$PREDICTIVE_CACHE" 2>/dev/null || true
        fi
        
        sleep 30
    done
}

case $1 in
    start) ai_monitor ;;
    predict) 
        username="$2"
        grep "^$username:" "$PREDICTIVE_CACHE" 2>/dev/null | cut -d: -f2 || echo "0"
        ;;
    *) echo "Usage: elite-x-ai {start|predict username}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-ai
}

# ==================== NEURAL NETWORK OPTIMIZER ====================
setup_neural_optimizer() {
    cat > /usr/local/bin/elite-x-neural <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NC='\033[0m'; BOLD='\033[1m'

NEURAL_CONFIG="/etc/elite-x/neural.conf"
SYNAPSE_FILE="/etc/elite-x/neural/synapses.dat"

# Neural network layers
declare -a INPUT_LAYER=("cpu" "memory" "connections" "traffic" "latency")
declare -a HIDDEN_LAYER=("weight1" "weight2" "weight3")
declare -a OUTPUT_LAYER=("speed" "stability" "efficiency")

# Initialize neural network
init_neural() {
    echo "0.5:0.5:0.5" > "$SYNAPSE_FILE"
    cat > "$NEURAL_CONFIG" <<CONF
# Neural Network Configuration
learning_rate=0.01
momentum=0.9
batch_size=32
activation=relu
CONF
}

# Calculate optimal settings
neural_calculate() {
    local cpu_load="$1"
    local mem_usage="$2"
    local connections="$3"
    local traffic="$4"
    local latency="$5"
    
    # Neural network calculation (simplified)
    local input_sum=$((cpu_load + mem_usage + connections + traffic + latency))
    local hidden=$((input_sum / 5))
    local output=$((hidden * 2))
    
    echo "$output"
}

# Apply neural optimization
neural_optimize() {
    echo -e "${NEON_CYAN}ğŸ§  Neural Network Optimizing System...${NC}"
    
    # Gather metrics
    local cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d. -f1)
    local mem=$(free | grep Mem | awk '{print ($3/$2) * 100}' | cut -d. -f1)
    local conn=$(ss -tnp | grep :22 | grep ESTAB | wc -l)
    local traffic=$(cat /sys/class/net/eth0/statistics/rx_bytes 2>/dev/null | awk '{print $1/1048576}')
    local ping=$(ping -c 1 google.com 2>/dev/null | grep time= | cut -d= -f4 | cut -d. -f1)
    
    [ -z "$ping" ] && ping=50
    
    # Neural calculation
    local optimal=$(neural_calculate $cpu $mem $conn $traffic $ping)
    
    # Apply optimizations based on neural output
    if [ $optimal -gt 80 ]; then
        echo -e "${NEON_GREEN}ğŸ§  Neural: High performance mode${NC}"
        # Aggressive optimization
        sysctl -w net.core.rmem_max=268435456 >/dev/null 2>&1
        sysctl -w net.core.wmem_max=268435456 >/dev/null 2>&1
    elif [ $optimal -gt 50 ]; then
        echo -e "${NEON_YELLOW}ğŸ§  Neural: Balanced mode${NC}"
        # Balanced optimization
        sysctl -w net.core.rmem_max=134217728 >/dev/null 2>&1
        sysctl -w net.core.wmem_max=134217728 >/dev/null 2>&1
    else
        echo -e "${NEON_BLUE}ğŸ§  Neural: Power saving mode${NC}"
        # Conservative optimization
        sysctl -w net.core.rmem_max=67108864 >/dev/null 2>&1
        sysctl -w net.core.wmem_max=67108864 >/dev/null 2>&1
    fi
    
    echo -e "${NEON_GREEN}âœ… Neural optimization complete (score: $optimal)${NC}"
}

# Neural monitor loop
neural_monitor() {
    init_neural
    
    while true; do
        neural_optimize
        sleep 60
    done
}

case $1 in
    start) neural_monitor ;;
    optimize) neural_optimize ;;
    *) echo "Usage: elite-x-neural {start|optimize}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-neural
}

# ==================== QUANTUM ENCRYPTION SIMULATOR ====================
setup_quantum_encryption() {
    cat > /usr/local/bin/elite-x-quantum <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NEON_PURPLE='\033[1;35m'
NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

QUANTUM_KEY="/etc/elite-x/quantum.key"
QUANTUM_STATE="/etc/elite-x/quantum/state.dat"

# Generate quantum key
generate_quantum_key() {
    echo -e "${NEON_PURPLE}âš›ï¸ Generating quantum encryption key...${NC}"
    
    # Create quantum key using system entropy
    dd if=/dev/urandom bs=32 count=1 2>/dev/null | base64 > "$QUANTUM_KEY"
    
    # Generate quantum state
    echo "$(date +%s%N):$(shuf -i 1-1000000 -n 1)" > "$QUANTUM_STATE"
    
    echo -e "${NEON_GREEN}âœ… Quantum key generated${NC}"
}

# Quantum encrypt data
quantum_encrypt() {
    local data="$1"
    local key=$(cat "$QUANTUM_KEY" 2>/dev/null || echo "quantum-default")
    
    # Simple XOR "quantum" encryption
    echo -n "$data" | openssl enc -aes-256-cbc -pbkdf2 -pass pass:"$key" 2>/dev/null | base64
}

# Quantum decrypt data
quantum_decrypt() {
    local data="$1"
    local key=$(cat "$QUANTUM_KEY" 2>/dev/null || echo "quantum-default")
    
    echo -n "$data" | base64 -d 2>/dev/null | openssl enc -aes-256-cbc -d -pbkdf2 -pass pass:"$key" 2>/dev/null
}

# Quantum handshake simulation
quantum_handshake() {
    local client="$1"
    local timestamp=$(date +%s)
    local nonce=$(shuf -i 1000000-9999999 -n 1)
    
    # Simulate quantum entanglement
    local entanglement=$((timestamp ^ nonce))
    
    echo "$client:$entanglement" >> /etc/elite-x/quantum/entanglements.log
    
    echo -e "${NEON_CYAN}âš›ï¸ Quantum handshake with $client established (entanglement: $entanglement)${NC}"
}

# Quantum monitor
quantum_monitor() {
    generate_quantum_key
    
    while true; do
        # Simulate quantum key rotation
        if [ $((RANDOM % 100)) -lt 5 ]; then
            generate_quantum_key
            echo "$(date): Quantum key rotated" >> /var/log/elite-x-quantum.log
        fi
        sleep 60
    done
}

case $1 in
    start) quantum_monitor ;;
    key) cat "$QUANTUM_KEY" 2>/dev/null || echo "No quantum key" ;;
    handshake) quantum_handshake "$2" ;;
    encrypt) quantum_encrypt "$2" ;;
    decrypt) quantum_decrypt "$2" ;;
    *) echo "Usage: elite-x-quantum {start|key|handshake|encrypt|decrypt}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-quantum
}

# ==================== PREDICTIVE CACHING ENGINE ====================
setup_predictive_cache() {
    cat > /usr/local/bin/elite-x-predictive <<'EOF'
#!/bin/bash

NEON_CYAN='\033[1;36m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NC='\033[0m'; BOLD='\033[1m'

CACHE_DIR="/etc/elite-x/predictive"
CACHE_FILE="$CACHE_DIR/cache.dat"
HISTORY_FILE="$CACHE_DIR/history.log"
PREDICTION_FILE="$CACHE_DIR/prediction.dat"

mkdir -p "$CACHE_DIR"

# Predictive algorithm
predict_next() {
    local username="$1"
    local history=$(grep "^$username:" "$HISTORY_FILE" 2>/dev/null | tail -10 | cut -d: -f3)
    
    if [ -z "$history" ]; then
        echo "50"
        return
    fi
    
    # Simple linear regression prediction
    local sum=0
    local count=0
    for value in $history; do
        sum=$((sum + value))
        count=$((count + 1))
    done
    
    echo $((sum / count))
}

# Cache popular data
cache_popular() {
    local key="$1"
    local value="$2"
    local ttl="${3:-300}"
    
    echo "$key:$value:$(($(date +%s) + ttl))" >> "$CACHE_FILE"
}

# Get from cache
get_cached() {
    local key="$1"
    local now=$(date +%s)
    
    while read line; do
        cached_key=$(echo "$line" | cut -d: -f1)
        cached_value=$(echo "$line" | cut -d: -f2)
        cached_expiry=$(echo "$line" | cut -d: -f3)
        
        if [ "$cached_key" = "$key" ] && [ $now -lt $cached_expiry ]; then
            echo "$cached_value"
            return
        fi
    done < "$CACHE_FILE" 2>/dev/null
}

# Predictive monitor
predictive_monitor() {
    while true; do
        # Clean expired cache
        local now=$(date +%s)
        local temp_file="${CACHE_FILE}.tmp"
        
        while read line; do
            expiry=$(echo "$line" | cut -d: -f3)
            if [ $now -lt $expiry ]; then
                echo "$line" >> "$temp_file"
            fi
        done < "$CACHE_FILE" 2>/dev/null
        
        mv "$temp_file" "$CACHE_FILE" 2>/dev/null || true
        
        # Update predictions
        > "$PREDICTION_FILE"
        for user_file in /etc/elite-x/users/*; do
            [ ! -f "$user_file" ] && continue
            username=$(basename "$user_file")
            prediction=$(predict_next "$username")
            echo "$username:$prediction" >> "$PREDICTION_FILE"
        done
        
        sleep 60
    done
}

case $1 in
    start) predictive_monitor ;;
    get) get_cached "$2" ;;
    put) cache_popular "$2" "$3" "$4" ;;
    predict) predict_next "$2" ;;
    *) echo "Usage: elite-x-predictive {start|get|put|predict}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-predictive
}

# ==================== DDoS PROTECTION SYSTEM ====================
setup_ddos_protection() {
    cat > /usr/local/bin/elite-x-ddos <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NC='\033[0m'; BOLD='\033[1m'

DDOS_CONF="/etc/elite-x/ddos.conf"
CONNECTION_LOG="/var/log/elite-x-connections.log"
BLACKLIST="/etc/elite-x/blacklist.txt"
WHITELIST="/etc/elite-x/whitelist.txt"

# Default thresholds
CONNECTION_LIMIT=100
PORT_SCAN_THRESHOLD=20
SYN_FLOOD_THRESHOLD=50

init_ddos() {
    cat > "$DDOS_CONF" <<CONF
# DDoS Protection Configuration
connection_limit=100
port_scan_threshold=20
syn_flood_threshold=50
ban_duration=3600
CONF
    
    touch "$BLACKLIST" "$WHITELIST"
}

# Monitor connections
monitor_connections() {
    local ip="$1"
    local count=$(grep "$ip" "$CONNECTION_LOG" 2>/dev/null | wc -l)
    
    echo "$count"
}

# Check for DDoS
check_ddos() {
    local threshold="$CONNECTION_LIMIT"
    
    # Get top talkers
    ss -tnp | grep ESTAB | awk '{print $5}' | cut -d: -f1 | sort | uniq -c | sort -nr | while read count ip; do
        if [ $count -gt $threshold ]; then
            # Check if whitelisted
            if ! grep -q "$ip" "$WHITELIST" 2>/dev/null; then
                echo -e "${NEON_RED}âš ï¸ DDoS detected from $ip ($count connections)${NC}"
                
                # Add to blacklist
                echo "$ip:$(date +%s)" >> "$BLACKLIST"
                
                # Block IP
                iptables -A INPUT -s "$ip" -j DROP 2>/dev/null
                iptables -A FORWARD -s "$ip" -j DROP 2>/dev/null
                
                echo "$(date): Blocked $ip (DDoS)" >> /var/log/elite-x-ddos.log
            fi
        fi
    done
}

# Clean old blacklist entries
clean_blacklist() {
    local now=$(date +%s)
    local ban_duration=3600
    local temp_file="${BLACKLIST}.tmp"
    
    while read line; do
        ip=$(echo "$line" | cut -d: -f1)
        timestamp=$(echo "$line" | cut -d: -f2)
        
        if [ $((now - timestamp)) -lt $ban_duration ]; then
            echo "$line" >> "$temp_file"
        else
            # Unblock IP
            iptables -D INPUT -s "$ip" -j DROP 2>/dev/null
            iptables -D FORWARD -s "$ip" -j DROP 2>/dev/null
        fi
    done < "$BLACKLIST" 2>/dev/null
    
    mv "$temp_file" "$BLACKLIST" 2>/dev/null || true
}

# Main DDoS monitor
ddos_monitor() {
    init_ddos
    
    while true; do
        # Log current connections
        ss -tnp | grep ESTAB | awk '{print $5}' | cut -d: -f1 | while read ip; do
            echo "$(date +%s):$ip" >> "$CONNECTION_LOG"
        done
        
        # Keep only last 10000 entries
        tail -n 10000 "$CONNECTION_LOG" > "${CONNECTION_LOG}.tmp"
        mv "${CONNECTION_LOG}.tmp" "$CONNECTION_LOG"
        
        # Check for attacks
        check_ddos
        
        # Clean blacklist
        clean_blacklist
        
        sleep 10
    done
}

case $1 in
    start) ddos_monitor ;;
    block) 
        iptables -A INPUT -s "$2" -j DROP
        echo "$2:$(date +%s)" >> "$BLACKLIST"
        echo -e "${NEON_RED}âœ… Blocked $2${NC}"
        ;;
    unblock)
        iptables -D INPUT -s "$2" -j DROP 2>/dev/null
        sed -i "/^$2:/d" "$BLACKLIST"
        echo -e "${NEON_GREEN}âœ… Unblocked $2${NC}"
        ;;
    whitelist)
        echo "$2" >> "$WHITELIST"
        echo -e "${NEON_GREEN}âœ… Whitelisted $2${NC}"
        ;;
    *) echo "Usage: elite-x-ddos {start|block|unblock|whitelist}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-ddos
}

# ==================== BEHAVIOR PROFILING ENGINE ====================
setup_behavior_profiling() {
    cat > /usr/local/bin/elite-x-behavior <<'EOF'
#!/bin/bash

NEON_CYAN='\033[1;36m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_RED='\033[1;31m'; NC='\033[0m'; BOLD='\033[1m'

PROFILE_DIR="/etc/elite-x/profiles"
BEHAVIOR_LOG="/var/log/elite-x-behavior.log"

mkdir -p "$PROFILE_DIR"

# Create user profile
create_profile() {
    local username="$1"
    local profile_file="$PROFILE_DIR/$username.profile"
    
    cat > "$profile_file" <<PROFILE
# Behavior Profile for $username
created=$(date +%s)
last_seen=$(date +%s)
avg_connections=0
peak_connections=0
avg_session_duration=0
preferred_ips=""
risk_score=0
behavior_pattern="normal"
PROFILE
    
    echo -e "${NEON_GREEN}âœ… Created behavior profile for $username${NC}"
}

# Update profile with behavior
update_behavior() {
    local username="$1"
    local profile_file="$PROFILE_DIR/$username.profile"
    
    if [ ! -f "$profile_file" ]; then
        create_profile "$username"
    fi
    
    # Get current session info
    local sessions=$(ps -u "$username" 2>/dev/null | grep -c "sshd" || echo "0")
    local ips=$(ss -tnp | grep "$username" | awk '{print $5}' | cut -d: -f1 | sort -u | tr '\n' ' ')
    
    # Update profile
    sed -i "s/last_seen=.*/last_seen=$(date +%s)/" "$profile_file"
    
    # Calculate risk score based on behavior
    local risk=0
    local avg_conn=$(grep avg_connections "$profile_file" | cut -d= -f2)
    
    if [ $sessions -gt $((avg_conn * 2)) ]; then
        risk=$((risk + 30))
        echo "$(date): Unusual connection count for $username" >> "$BEHAVIOR_LOG"
    fi
    
    # Multiple IPs in short time
    local ip_count=$(echo $ips | wc -w)
    if [ $ip_count -gt 3 ]; then
        risk=$((risk + 20))
        echo "$(date): Multiple IPs for $username: $ips" >> "$BEHAVIOR_LOG"
    fi
    
    # Update risk score
    sed -i "s/risk_score=.*/risk_score=$risk/" "$profile_file"
    
    # Take action if high risk
    if [ $risk -gt 50 ]; then
        echo -e "${NEON_RED}âš ï¸ High risk behavior detected for $username (score: $risk)${NC}"
        # Apply restrictions
        pkill -u "$username" 2>/dev/null || true
        usermod -L "$username" 2>/dev/null
    fi
}

# Analyze all users
analyze_all() {
    for user_file in /etc/elite-x/users/*; do
        [ ! -f "$user_file" ] && continue
        username=$(basename "$user_file")
        update_behavior "$username"
    done
}

# Show profile
show_profile() {
    local username="$1"
    local profile_file="$PROFILE_DIR/$username.profile"
    
    if [ ! -f "$profile_file" ]; then
        echo -e "${NEON_RED}No profile for $username${NC}"
        return
    fi
    
    echo -e "${NEON_CYAN}Behavior Profile for $username:${NC}"
    cat "$profile_file"
}

# Behavior monitor
behavior_monitor() {
    while true; do
        analyze_all
        sleep 30
    done
}

case $1 in
    start) behavior_monitor ;;
    profile) show_profile "$2" ;;
    analyze) update_behavior "$2" ;;
    *) echo "Usage: elite-x-behavior {start|profile|analyze}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-behavior
}

# ==================== SELF-HEALING SYSTEM ====================
setup_self_healing() {
    cat > /usr/local/bin/elite-x-selfheal <<'EOF'
#!/bin/bash

NEON_CYAN='\033[1;36m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_RED='\033[1;31m'; NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

HEAL_LOG="/var/log/elite-x-heal.log"
HEAL_STATE="/etc/elite-x/selfheal.state"

# Check service health
check_service() {
    local service="$1"
    if systemctl is-active "$service" >/dev/null 2>&1; then
        return 0
    else
        return 1
    fi
}

# Heal service
heal_service() {
    local service="$1"
    echo "$(date): Healing $service" >> "$HEAL_LOG"
    
    systemctl stop "$service" 2>/dev/null
    sleep 2
    systemctl start "$service" 2>/dev/null
    
    if check_service "$service"; then
        echo -e "${NEON_GREEN}âœ… Healed $service successfully${NC}"
        return 0
    else
        echo -e "${NEON_RED}âŒ Failed to heal $service${NC}"
        return 1
    fi
}

# Check system health
check_system_health() {
    local issues=0
    
    # Check DNS port
    if ! ss -uln | grep -q ":53 "; then
        echo -e "${NEON_RED}âš ï¸ Port 53 not listening${NC}"
        issues=$((issues + 1))
    fi
    
    # Check DNSTT port
    if ! ss -uln | grep -q ":5300 "; then
        echo -e "${NEON_RED}âš ï¸ Port 5300 not listening${NC}"
        issues=$((issues + 1))
    fi
    
    # Check SSH
    if ! systemctl is-active sshd >/dev/null 2>&1; then
        echo -e "${NEON_RED}âš ï¸ SSH not running${NC}"
        issues=$((issues + 1))
    fi
    
    # Check disk space
    local disk_usage=$(df / | awk 'NR==2{print $5}' | sed 's/%//')
    if [ $disk_usage -gt 90 ]; then
        echo -e "${NEON_RED}âš ï¸ Low disk space: ${disk_usage}%${NC}"
        issues=$((issues + 1))
    fi
    
    return $issues
}

# Self-heal
self_heal() {
    echo -e "${NEON_CYAN}${BLINK}ğŸ”§ Self-healing system activated${NC}"
    
    local healed=0
    
    # Heal services
    for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic sshd; do
        if ! check_service "$service"; then
            if heal_service "$service"; then
                healed=$((healed + 1))
            fi
        fi
    done
    
    # Restart failed services
    systemctl daemon-reload
    
    echo -e "${NEON_GREEN}âœ… Self-heal complete: $healed services restored${NC}"
    echo "$(date): Self-heal complete - $healed services restored" >> "$HEAL_LOG"
}

# Continuous healing monitor
heal_monitor() {
    while true; do
        if ! check_system_health >/dev/null 2>&1; then
            self_heal
        fi
        sleep 60
    done
}

case $1 in
    start) heal_monitor ;;
    heal) self_heal ;;
    check) check_system_health ;;
    *) echo "Usage: elite-x-selfheal {start|heal|check}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-selfheal
}

# ==================== HOLOGRAPHIC DASHBOARD ====================
setup_holographic_dashboard() {
    cat > /usr/local/bin/elite-x-hologram <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_BLUE='\033[1;34m'; NEON_PURPLE='\033[1;35m'; NEON_CYAN='\033[1;36m'
NEON_PINK='\033[1;38;5;201m'; NEON_WHITE='\033[1;37m'
NEON_GOLD='\033[1;38;5;220m'; NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

HOLOGRAM_CACHE="/tmp/elite-x-hologram"
mkdir -p "$HOLOGRAM_CACHE"

# Generate 3D effect
generate_hologram() {
    clear
    
    # Top border with 3D effect
    echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}${BLINK}                        3D HOLOGRAPHIC DASHBOARD                            ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    
    # System metrics with 3D bars
    local cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d. -f1)
    local mem=$(free | grep Mem | awk '{print ($3/$2) * 100}' | cut -d. -f1)
    local disk=$(df / | awk 'NR==2{print $5}' | sed 's/%//')
    
    # Draw 3D CPU bar
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  CPU: ${NEON_CYAN}[${NC}"
    for i in {1..50}; do
        if [ $i -le $((cpu / 2)) ]; then
            echo -ne "${NEON_RED}â–ˆ${NC}"
        else
            echo -ne "${NEON_WHITE}â–‘${NC}"
        fi
    done
    echo -e "${NEON_CYAN}] ${NEON_GREEN}${cpu}%${NC} ${NEON_PURPLE}â•‘${NC}"
    
    # 3D Memory bar
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  MEM: ${NEON_CYAN}[${NC}"
    for i in {1..50}; do
        if [ $i -le $((mem / 2)) ]; then
            echo -ne "${NEON_YELLOW}â–ˆ${NC}"
        else
            echo -ne "${NEON_WHITE}â–‘${NC}"
        fi
    done
    echo -e "${NEON_CYAN}] ${NEON_GREEN}${mem}%${NC} ${NEON_PURPLE}â•‘${NC}"
    
    # 3D Disk bar
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  DISK: ${NEON_CYAN}[${NC}"
    for i in {1..50}; do
        if [ $i -le $((disk / 2)) ]; then
            echo -ne "${NEON_BLUE}â–ˆ${NC}"
        else
            echo -ne "${NEON_WHITE}â–‘${NC}"
        fi
    done
    echo -e "${NEON_CYAN}] ${NEON_GREEN}${disk}%${NC} ${NEON_PURPLE}â•‘${NC}"
    
    # Active connections with 3D effect
    local connections=$(ss -tnp | grep :22 | grep ESTAB | wc -l)
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  ACTIVE CONNECTIONS: ${NEON_GOLD}${connections}${NC}"
    
    # 3D sphere representation
    echo -e "${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                         â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤                         ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                       â¬¤                      â¬¤                       ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                     â¬¤        ELITE-X          â¬¤                     ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                   â¬¤         ULTIMATE           â¬¤                   ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                 â¬¤          EDITION             â¬¤                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                       â¬¤                      â¬¤                       ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}                         â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤â¬¤                         ${NEON_PURPLE}â•‘${NC}"
    
    # Bottom border
    echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    echo -e "${NEON_GOLD}Press Ctrl+C to exit - Auto-refresh 3s${NC}"
}

# Run hologram
while true; do
    generate_hologram
    sleep 3
done
EOF
    chmod +x /usr/local/bin/elite-x-hologram
}

# ==================== AUTO-SCALING CONNECTION POOL ====================
setup_auto_scaling() {
    cat > /usr/local/bin/elite-x-autoscale <<'EOF'
#!/bin/bash

NEON_CYAN='\033[1;36m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_RED='\033[1;31m'; NC='\033[0m'; BOLD='\033[1m'

SCALE_CONFIG="/etc/elite-x/autoscale.conf"
SCALE_STATE="/etc/elite-x/scale.state"

# Default scaling parameters
MIN_CONNECTIONS=10
MAX_CONNECTIONS=1000
SCALE_UP_THRESHOLD=80
SCALE_DOWN_THRESHOLD=20

init_scaling() {
    cat > "$SCALE_CONFIG" <<CONF
# Auto-scaling Configuration
min_connections=$MIN_CONNECTIONS
max_connections=$MAX_CONNECTIONS
scale_up_threshold=$SCALE_UP_THRESHOLD
scale_down_threshold=$SCALE_DOWN_THRESHOLD
scale_factor=2
CONF
}

# Get current load
get_current_load() {
    local connections=$(ss -tnp | grep :22 | grep ESTAB | wc -l)
    local cpu=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d. -f1)
    
    # Calculate load factor
    echo $((connections * cpu / 100))
}

# Scale up resources
scale_up() {
    local current="$1"
    local target=$((current * 2))
    
    echo -e "${NEON_YELLOW}ğŸ“ˆ Scaling up connections to $target${NC}"
    
    # Increase system limits
    sysctl -w fs.file-max=$((target * 1000)) >/dev/null 2>&1
    sysctl -w net.core.somaxconn=$target >/dev/null 2>&1
    
    echo "$(date): Scaled up to $target" >> /var/log/elite-x-scale.log
    echo "current_scale=$target" > "$SCALE_STATE"
}

# Scale down resources
scale_down() {
    local current="$1"
    local target=$((current / 2))
    
    [ $target -lt $MIN_CONNECTIONS ] && target=$MIN_CONNECTIONS
    
    echo -e "${NEON_CYAN}ğŸ“‰ Scaling down connections to $target${NC}"
    
    # Decrease system limits
    sysctl -w fs.file-max=$((target * 1000)) >/dev/null 2>&1
    sysctl -w net.core.somaxconn=$target >/dev/null 2>&1
    
    echo "$(date): Scaled down to $target" >> /var/log/elite-x-scale.log
    echo "current_scale=$target" > "$SCALE_STATE"
}

# Auto-scale monitor
auto_scale_monitor() {
    init_scaling
    
    while true; do
        local load=$(get_current_load)
        local current_scale=$(cat "$SCALE_STATE" 2>/dev/null | cut -d= -f2 || echo "$MIN_CONNECTIONS")
        
        if [ $load -gt $SCALE_UP_THRESHOLD ] && [ $current_scale -lt $MAX_CONNECTIONS ]; then
            scale_up "$current_scale"
        elif [ $load -lt $SCALE_DOWN_THRESHOLD ] && [ $current_scale -gt $MIN_CONNECTIONS ]; then
            scale_down "$current_scale"
        fi
        
        sleep 30
    done
}

case $1 in
    start) auto_scale_monitor ;;
    status) cat "$SCALE_STATE" 2>/dev/null || echo "Not scaled" ;;
    *) echo "Usage: elite-x-autoscale {start|status}" ;;
esac
EOF
    chmod +x /usr/local/bin/elite-x-autoscale
}

# ==================== ULTIMATE USER MANAGER (FIXED) ====================
setup_ultimate_user_manager() {
    cat > /usr/local/bin/elite-x-user <<'EOF'
#!/bin/bash

# ==================== ULTIMATE COLOR DEFINITIONS ====================
NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NEON_PURPLE='\033[1;35m'
NEON_BLUE='\033[1;34m'; NEON_PINK='\033[1;38;5;201m'
NEON_GOLD='\033[1;38;5;220m'; NEON_SILVER='\033[1;38;5;250m'
NEON_ORANGE='\033[1;38;5;208m'; NEON_LIME='\033[1;38;5;154m'
NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

UD="/etc/elite-x/users"
TD="/etc/elite-x/traffic"
AD="/etc/elite-x/archive"
QD="/etc/elite-x/quantum"
mkdir -p $UD $TD $AD $QD

# ==================== ULTIMATE FUNCTIONS ====================

# Check if user exists in system
user_exists() {
    id "$1" &>/dev/null
    return $?
}

# Quantum process killer (kills at quantum level)
quantum_kill_processes() {
    local username="$1"
    echo -e "${NEON_RED}âš›ï¸ Quantum killing all processes for $username...${NC}"
    
    # Get all PIDs
    local pids=$(pgrep -u "$username" 2>/dev/null)
    
    # Kill gently first
    for pid in $pids; do
        kill "$pid" 2>/dev/null || true
    done
    
    sleep 2
    
    # Force kill remaining
    for pid in $(pgrep -u "$username" 2>/dev/null); do
        kill -9 "$pid" 2>/dev/null || true
    done
    
    # Kill SSH sessions specifically
    for pid in $(pgrep -f "sshd:.*$username" 2>/dev/null); do
        kill -9 "$pid" 2>/dev/null || true
    done
    
    # Kill any screen/tmux sessions
    for pid in $(pgrep -f "screen.*$username" 2>/dev/null); do
        kill -9 "$pid" 2>/dev/null || true
    done
    
    echo -e "${NEON_GREEN}âœ… Quantum kill complete${NC}"
}

# Get real traffic usage with AI prediction
get_ai_traffic() {
    local username="$1"
    
    if [ -f "$TD/$username" ]; then
        current=$(cat "$TD/$username")
        predicted=$(elite-x-ai predict "$username" 2>/dev/null || echo "0")
        echo "$current:$predicted"
    else
        echo "0:0"
    fi
}

# Quantum complete removal
quantum_remove_user() {
    local username="$1"
    
    # Quantum kill processes
    quantum_kill_processes "$username"
    
    # Archive user info with quantum encryption
    if [ -f "$UD/$username" ]; then
        cp "$UD/$username" "$AD/${username}_$(date +%Y%m%d_%H%M%S).txt" 2>/dev/null
        # Create quantum backup
        openssl enc -aes-256-cbc -in "$UD/$username" -out "$QD/${username}.quantum" -pass pass:"$(date +%s)" 2>/dev/null || true
    fi
    
    # Remove from sshd_config
    sed -i "/Match User $username/,+3 d" /etc/ssh/sshd_config 2>/dev/null
    
    # Remove user from system
    if user_exists "$username"; then
        userdel -f -r "$username" 2>/dev/null
        # Double check
        if user_exists "$username"; then
            # More aggressive removal
            userdel -f -r "$username" 2>/dev/null
            rm -rf "/home/$username" 2>/dev/null
            rm -rf "/var/mail/$username" 2>/dev/null
        fi
    fi
    
    # Remove our files
    rm -f "$UD/$username" "$TD/$username" 2>/dev/null
    rm -f "$TD/${username}.history" 2>/dev/null
    
    # Restart sshd
    systemctl restart sshd 2>/dev/null
    
    # Final verification
    if user_exists "$username"; then
        return 1
    else
        return 0
    fi
}

# Set quantum connection limit
set_quantum_limit() {
    local username="$1"
    local limit="$2"
    
    if [ "$limit" -gt 0 ]; then
        # Remove any existing limit
        sed -i "/Match User $username/,+3 d" /etc/ssh/sshd_config 2>/dev/null
        
        # Add new limit with quantum parameters
        cat >> /etc/ssh/sshd_config <<LIMIT
Match User $username
    MaxSessions $limit
    MaxAuthTries 2
    ClientAliveInterval 30
    ClientAliveCountMax 2
LIMIT
        systemctl restart sshd
        echo -e "${NEON_GREEN}âœ… Quantum connection limit set to $limit for $username${NC}"
    else
        # Remove limit
        sed -i "/Match User $username/,+3 d" /etc/ssh/sshd_config 2>/dev/null
        systemctl restart sshd
        echo -e "${NEON_GREEN}âœ… Connection limit removed for $username${NC}"
    fi
}

# ==================== ULTIMATE USER FUNCTIONS ====================

add_user() {
    clear
    echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_PURPLE}${BOLD}              CREATE QUANTUM SSH + DNS USER                            ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    # Check if user exists
    if user_exists "$username"; then
        echo -e "${NEON_RED}âŒ User '$username' already exists in system!${NC}"
        
        # Check if we have orphaned files
        if [ ! -f "$UD/$username" ]; then
            echo -e "${NEON_YELLOW}âš ï¸ User exists but not in ELITE-X database${NC}"
            read -p "Remove system user and recreate? (y/n): " remove_choice
            if [ "$remove_choice" = "y" ]; then
                quantum_kill_processes "$username"
                userdel -f -r "$username" 2>/dev/null
                if user_exists "$username"; then
                    echo -e "${NEON_RED}âŒ Failed to remove system user${NC}"
                    read -p "Press Enter to continue..."
                    return
                fi
            else
                return
            fi
        else
            echo -e "${NEON_YELLOW}âš ï¸ User exists in both system and database${NC}"
            read -p "Delete existing user and recreate? (y/n): " delete_choice
            if [ "$delete_choice" = "y" ]; then
                if ! quantum_remove_user "$username"; then
                    echo -e "${NEON_RED}âŒ Failed to remove existing user${NC}"
                    read -p "Press Enter to continue..."
                    return
                fi
            else
                return
            fi
        fi
    fi
    
    # Clean up any leftover files
    rm -f "$UD/$username" "$TD/$username" 2>/dev/null
    
    read -p "$(echo -e $NEON_GREEN"Password: "$NC)" password
    read -p "$(echo -e $NEON_GREEN"Expire days: "$NC)" days
    read -p "$(echo -e $NEON_GREEN"Traffic limit (MB, 0 for unlimited): "$NC)" traffic_limit
    read -p "$(echo -e $NEON_GREEN"Max concurrent connections (0 for unlimited): "$NC)" max_connections
    
    # Create user with advanced shell
    useradd -m -s /bin/false "$username"
    echo "$username:$password" | chpasswd
    
    # Set expiry
    expire_date=$(date -d "+$days days" +"%Y-%m-%d")
    chage -E "$expire_date" "$username"
    
    # Set connection limit
    if [ "$max_connections" -gt 0 ]; then
        set_quantum_limit "$username" "$max_connections"
    fi
    
    # Save to database with quantum info
    cat > "$UD/$username" <<INFO
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        QUANTUM USER PROFILE
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
Username: $username
Password: $password
Expire: $expire_date
Traffic_Limit: $traffic_limit MB
Max_Logins: $max_connections
Created: $(date +"%Y-%m-%d %H:%M:%S")
Quantum_ID: $(openssl rand -hex 8)
Encryption: AES-256-Quantum
Status: ACTIVE
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
INFO
    
    # Initialize traffic counter with AI prediction
    echo "0" > "$TD/$username"
    echo "$(date +%s):0" > "$TD/${username}.history"
    
    # Get server info
    SERVER=$(cat /etc/elite-x/subdomain 2>/dev/null || echo "?")
    PUBKEY=$(cat /etc/dnstt/server.pub 2>/dev/null || echo "Not generated")
    QUANTUM_KEY=$(cat /etc/elite-x/quantum.key 2>/dev/null || echo "Quantum ready")
    
    clear
    echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_PURPLE}${BOLD}                  QUANTUM USER DETAILS                                 ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Username     : ${NEON_CYAN}$username${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Password     : ${NEON_CYAN}$password${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Server       : ${NEON_CYAN}$SERVER${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Public Key   : ${NEON_GREEN}$PUBKEY${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Quantum Key  : ${NEON_PURPLE}$QUANTUM_KEY${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Expire       : ${NEON_YELLOW}$expire_date${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Traffic Limit: ${NEON_ORANGE}$traffic_limit MB${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Max Connections: ${NEON_PINK}$max_connections${NC}"
    echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    # Log creation
    echo "$(date): QUANTUM CREATED - User $username (expires: $expire_date)" >> /var/log/elite-x-quantum.log
    
    echo ""
    read -p "Press Enter to continue..."
}

list_users() {
    clear
    echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_CYAN}â•‘${NEON_YELLOW}${BOLD}              QUANTUM USER LIST (AI-POWERED REAL-TIME)                     ${NEON_CYAN}â•‘${NC}"
    echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    if [ -z "$(ls -A $UD 2>/dev/null)" ]; then
        echo -e "${NEON_RED}No quantum users found${NC}"
        echo ""
        read -p "Press Enter to continue..."
        return
    fi
    
    printf "${NEON_GOLD}%-15s %-12s %-10s %-10s %-10s %-8s %s${NC}\n" "USERNAME" "EXPIRE" "LIMIT(MB)" "USED(MB)" "AI PREDICT" "CONNS" "STATUS"
    echo -e "${NEON_PURPLE}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    TOTAL_TRAFFIC=0
    TOTAL_USERS=0
    ONLINE_COUNT=0
    
    for user_file in "$UD"/*; do
        [ ! -f "$user_file" ] && continue
        username=$(basename "$user_file")
        
        # Skip if user doesn't exist in system (clean up)
        if ! user_exists "$username"; then
            echo -e "${NEON_YELLOW}âš ï¸ Orphaned entry for $username - cleaning up${NC}"
            rm -f "$user_file" "$TD/$username" "$TD/${username}.history" 2>/dev/null
            continue
        fi
        
        expire=$(grep "Expire:" "$user_file" | cut -d' ' -f2)
        limit=$(grep "Traffic_Limit:" "$user_file" | cut -d' ' -f2)
        max_conn=$(grep "Max_Logins:" "$user_file" | cut -d' ' -f2)
        
        # Get AI traffic data
        traffic_data=$(get_ai_traffic "$username")
        used=$(echo "$traffic_data" | cut -d: -f1)
        predicted=$(echo "$traffic_data" | cut -d: -f2)
        
        # Count current connections
        current_conn=$(ps -u "$username" 2>/dev/null | grep -c "sshd" || echo "0")
        if [ "$current_conn" -gt 0 ]; then
            ONLINE_COUNT=$((ONLINE_COUNT + 1))
        fi
        
        # Check status
        if passwd -S "$username" 2>/dev/null | grep -q "L"; then
            status="${NEON_RED}LOCKED${NC}"
        else
            if [ "$limit" -gt 0 ] && [ "$used" -gt "$limit" ]; then
                status="${NEON_RED}LIMIT EXCEEDED${NC}"
            else
                status="${NEON_GREEN}ACTIVE${NC}"
            fi
        fi
        
        # AI prediction color
        if [ "$predicted" -gt "$limit" ] && [ "$limit" -gt 0 ]; then
            pred_color="${NEON_RED}"
        else
            pred_color="${NEON_GREEN}"
        fi
        
        printf "${NEON_CYAN}%-15s ${NEON_YELLOW}%-12s ${NEON_WHITE}%-10s ${NEON_ORANGE}%-10s ${pred_color}%-10s ${NEON_PINK}%-8s %b${NC}\n" \
               "$username" "$expire" "$limit" "$used" "${predicted}MB" "$current_conn/$max_conn" "$status"
        
        TOTAL_TRAFFIC=$((TOTAL_TRAFFIC + used))
        TOTAL_USERS=$((TOTAL_USERS + 1))
    done
    
    echo -e "${NEON_PURPLE}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    echo -e "${NEON_GOLD}Total Users: ${NEON_GREEN}$TOTAL_USERS${NC}  ${NEON_GOLD}Online: ${NEON_GREEN}$ONLINE_COUNT${NC}  ${NEON_GOLD}Total Traffic: ${NEON_GREEN}$TOTAL_TRAFFIC MB${NC}  ${NEON_GOLD}AI Active: ${NEON_GREEN}âœ“${NC}"
    
    echo ""
    read -p "Press Enter to continue..."
}

delete_user() {
    echo -e "${NEON_RED}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_RED}â•‘${NEON_YELLOW}${BOLD}              QUANTUM USER DELETION                              ${NEON_RED}â•‘${NC}"
    echo -e "${NEON_RED}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    # Check if user exists anywhere
    local in_system=false
    local in_db=false
    
    if user_exists "$username"; then
        in_system=true
    fi
    
    if [ -f "$UD/$username" ]; then
        in_db=true
    fi
    
    if [ "$in_system" = false ] && [ "$in_db" = false ]; then
        echo -e "${NEON_RED}âŒ User '$username' does not exist anywhere${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    echo -e "${NEON_YELLOW}Quantum scan results:${NC}"
    echo -e "  In system: $([ "$in_system" = true ] && echo "${NEON_GREEN}Yes${NC}" || echo "${NEON_RED}No${NC}")"
    echo -e "  In database: $([ "$in_db" = true ] && echo "${NEON_GREEN}Yes${NC}" || echo "${NEON_RED}No${NC}")"
    
    # Show active connections
    if [ "$in_system" = true ]; then
        local sessions=$(ps -u "$username" 2>/dev/null | grep -c "sshd" || echo "0")
        if [ "$sessions" -gt 0 ]; then
            echo -e "${NEON_RED}âš ï¸ User has $sessions active connection(s)${NC}"
        fi
    fi
    
    read -p "$(echo -e $NEON_RED"Are you sure you want to quantum delete? (YES to confirm): "$NC)" confirm
    if [ "$confirm" != "YES" ]; then
        echo -e "${NEON_YELLOW}Deletion cancelled${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    if quantum_remove_user "$username"; then
        echo -e "${NEON_GREEN}âœ… Quantum removal complete for $username${NC}"
        echo "$(date): QUANTUM DELETED - User $username" >> /var/log/elite-x-quantum.log
    else
        echo -e "${NEON_RED}âŒ Failed to quantum remove user $username${NC}"
        echo -e "${NEON_YELLOW}Manual cleanup may be needed: userdel -f -r $username${NC}"
    fi
    
    read -p "Press Enter to continue..."
}

lock_user() {
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    if ! user_exists "$username"; then
        echo -e "${NEON_RED}âŒ User does not exist${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    usermod -L "$username" 2>/dev/null
    quantum_kill_processes "$username"
    echo -e "${NEON_GREEN}âœ… User $username quantum locked and disconnected${NC}"
    echo "$(date): QUANTUM LOCKED - User $username" >> /var/log/elite-x-quantum.log
    
    read -p "Press Enter to continue..."
}

unlock_user() {
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    if ! user_exists "$username"; then
        echo -e "${NEON_RED}âŒ User does not exist${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    usermod -U "$username" 2>/dev/null
    echo -e "${NEON_GREEN}âœ… User $username quantum unlocked${NC}"
    echo "$(date): QUANTUM UNLOCKED - User $username" >> /var/log/elite-x-quantum.log
    
    read -p "Press Enter to continue..."
}

set_limit() {
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    if ! user_exists "$username"; then
        echo -e "${NEON_RED}âŒ User does not exist${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    if [ ! -f "$UD/$username" ]; then
        echo -e "${NEON_RED}âŒ User not in quantum database${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    current=$(grep "Max_Logins:" "$UD/$username" | cut -d' ' -f2 || echo "0")
    echo -e "${NEON_WHITE}Current max connections: $current${NC}"
    read -p "$(echo -e $NEON_GREEN"New max connections (0 for unlimited): "$NC)" new_limit
    
    if [ "$new_limit" -ge 0 ] 2>/dev/null; then
        # Update database
        if grep -q "Max_Logins:" "$UD/$username"; then
            sed -i "s/Max_Logins:.*/Max_Logins: $new_limit/" "$UD/$username"
        else
            echo "Max_Logins: $new_limit" >> "$UD/$username"
        fi
        
        # Apply limit
        set_quantum_limit "$username" "$new_limit"
        
        echo "$(date): QUANTUM LIMIT CHANGED - User $username max connections set to $new_limit" >> /var/log/elite-x-quantum.log
    else
        echo -e "${NEON_RED}Invalid number${NC}"
    fi
    
    read -p "Press Enter to continue..."
}

show_details() {
    read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username
    
    if [ ! -f "$UD/$username" ]; then
        echo -e "${NEON_RED}âŒ User not found${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    if ! user_exists "$username"; then
        echo -e "${NEON_RED}âŒ User does not exist in system${NC}"
        read -p "Press Enter to continue..."
        return
    fi
    
    clear
    cat "$UD/$username"
    
    echo ""
    traffic_data=$(get_ai_traffic "$username")
    used=$(echo "$traffic_data" | cut -d: -f1)
    predicted=$(echo "$traffic_data" | cut -d: -f2)
    
    echo -e "${NEON_CYAN}Real-time Quantum Data:${NC}"
    echo -e "  Current Traffic: ${NEON_YELLOW}$used MB${NC}"
    echo -e "  AI Prediction: ${NEON_PURPLE}$predicted MB${NC}"
    echo -e "  Active Connections: ${NEON_GREEN}$(ps -u "$username" 2>/dev/null | grep -c "sshd" || echo "0")${NC}"
    
    # Show connection history
    if [ -f "$TD/${username}.history" ]; then
        echo -e "\n${NEON_CYAN}Connection History (last 5):${NC}"
        tail -5 "$TD/${username}.history" | while read line; do
            time=$(echo $line | cut -d: -f1)
            usage=$(echo $line | cut -d: -f2)
            echo -e "  $(date -d @$time +"%H:%M:%S"): ${NEON_GREEN}${usage}MB${NC}"
        done
    fi
    
    echo ""
    read -p "Press Enter to continue..."
}

# ==================== ULTIMATE MENU ====================
show_menu() {
    while true; do
        clear
        echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_PURPLE}${BOLD}              QUANTUM USER MANAGEMENT - ULTIMATE EDITION               ${NEON_GOLD}â•‘${NC}"
        echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [1] ğŸ‘¤ Add Quantum User${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [2] ğŸ“‹ List Quantum Users (AI-Powered)${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [3] ğŸ”’ Quantum Lock User${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [4] ğŸ”“ Quantum Unlock User${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [5] ğŸ—‘ï¸  Quantum Delete User (Complete Removal)${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [6] âš¡ Set Quantum Connection Limit${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [7] ğŸ“Š Quantum User Details${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [8] ğŸ”„ Reset User Traffic${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [9] ğŸ“ˆ Show Traffic Graph${NC}"
        echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  [0] â†©ï¸  Back to Quantum Main Menu${NC}"
        echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        read -p "$(echo -e $NEON_GREEN"Choose quantum option: "$NC)" opt
        
        case $opt in
            1) add_user ;;
            2) list_users ;;
            3) lock_user ;;
            4) unlock_user ;;
            5) delete_user ;;
            6) set_limit ;;
            7) show_details ;;
            8)
                read -p "$(echo -e $NEON_GREEN"Username: "$NC)" u
                if [ -f "$TD/$u" ]; then
                    echo "0" > "$TD/$u"
                    echo "$(date +%s):0" >> "$TD/${u}.history"
                    echo -e "${NEON_GREEN}âœ… Traffic reset for $u${NC}"
                else
                    echo -e "${NEON_RED}User not found${NC}"
                fi
                read -p "Press Enter..."
                ;;
            9)
                read -p "$(echo -e $NEON_GREEN"Username: "$NC)" u
                if [ -f "$TD/${u}.history" ]; then
                    echo -e "${NEON_CYAN}Traffic Graph for $u:${NC}"
                    tail -10 "$TD/${u}.history" | while read line; do
                        usage=$(echo $line | cut -d: -f2)
                        bars=$((usage / 10))
                        [ $bars -gt 50 ] && bars=50
                        printf "${NEON_GREEN}%4s MB ${NEON_YELLOW}" "$usage"
                        for i in $(seq 1 $bars); do echo -n "â–ˆ"; done
                        echo -e "${NC}"
                    done
                else
                    echo -e "${NEON_RED}No history for $u${NC}"
                fi
                read -p "Press Enter..."
                ;;
            0) return ;;
            *) echo -e "${NEON_RED}Invalid quantum option${NC}"; sleep 2 ;;
        esac
    done
}

show_menu
EOF
    chmod +x /usr/local/bin/elite-x-user
}

# ==================== ULTIMATE TRAFFIC MONITOR WITH AI ====================
setup_ultimate_traffic_monitor() {
    cat > /usr/local/bin/elite-x-traffic <<'EOF'
#!/bin/bash

TRAFFIC_DB="/etc/elite-x/traffic"
USER_DB="/etc/elite-x/users"
AI_MODEL="/etc/elite-x/ai_model.dat"
QUANTUM_LOG="/var/log/elite-x-quantum.log"

mkdir -p $TRAFFIC_DB

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> /var/log/elite-x-traffic.log
}

# AI-powered traffic calculation
get_quantum_traffic() {
    local username="$1"
    local total_rx=0
    local total_tx=0
    
    # Get all PIDs for this user
    local pids=$(pgrep -u "$username" 2>/dev/null | tr '\n' ' ')
    
    if [ ! -z "$pids" ]; then
        for pid in $pids; do
            if [ -f "/proc/$pid/net/dev" ]; then
                while read line; do
                    if [[ $line =~ ^[[:space:]]*([a-zA-Z0-9]+):[[:space:]]*([0-9]+) ]]; then
                        iface="${BASH_REMATCH[1]}"
                        if [ "$iface" != "lo" ]; then
                            rx_bytes=$(echo "$line" | awk '{print $2}')
                            tx_bytes=$(echo "$line" | awk '{print $10}')
                            total_rx=$((total_rx + rx_bytes))
                            total_tx=$((total_tx + tx_bytes))
                        fi
                    fi
                done < "/proc/$pid/net/dev" 2>/dev/null
            fi
        done
    fi
    
    # Calculate total in MB
    echo $(( (total_rx + total_tx) / 1048576 ))
}

# AI-powered traffic shaping
quantum_shape_traffic() {
    local username="$1"
    local current="$2"
    local limit="$3"
    
    if [ "$limit" -le 0 ]; then
        return
    fi
    
    local percent=$((current * 100 / limit))
    
    # Quantum decision making
    if [ $percent -ge 100 ]; then
        # Critical - quantum lockdown
        log_message "QUANTUM LOCKDOWN: User $username exceeded limit ($current/${limit}MB)"
        echo "$(date): QUANTUM LIMIT EXCEEDED - User $username ($current/${limit}MB)" >> "$QUANTUM_LOG"
        
        # Kill all connections with quantum force
        pkill -u "$username" 2>/dev/null || true
        sleep 2
        pkill -9 -u "$username" 2>/dev/null || true
        
        # Quantum lock
        usermod -L "$username" 2>/dev/null
        
        # Update status
        if [ -f "$USER_DB/$username" ]; then
            sed -i 's/Status:.*/Status: QUANTUM LOCKED (Traffic Limit)/' "$USER_DB/$username" 2>/dev/null
        fi
    elif [ $percent -ge 80 ]; then
        # Warning - quantum shaping
        log_message "QUANTUM WARNING: User $username at ${percent}% of limit"
        
        # Apply traffic shaping
        tc qdisc add dev eth0 root handle 1: htb default 30 2>/dev/null || true
        tc class add dev eth0 parent 1: classid 1:1 htb rate 512kbit 2>/dev/null || true
    fi
}

# Update traffic history for AI
update_quantum_history() {
    local username="$1"
    local usage="$2"
    local history_file="$TRAFFIC_DB/${username}.history"
    
    echo "$(date +%s):$usage" >> "$history_file"
    # Keep last 1000 entries
    tail -n 1000 "$history_file" > "${history_file}.tmp"
    mv "${history_file}.tmp" "$history_file"
}

# Main quantum monitor
quantum_monitor() {
    log_message "QUANTUM TRAFFIC MONITOR STARTED"
    
    while true; do
        if [ -d "$USER_DB" ]; then
            for user_file in "$USER_DB"/*; do
                [ ! -f "$user_file" ] && continue
                username=$(basename "$user_file")
                
                # Skip if user doesn't exist
                if ! id "$username" &>/dev/null; then
                    continue
                fi
                
                limit=$(grep "Traffic_Limit:" "$user_file" | cut -d' ' -f2)
                current=$(get_quantum_traffic "$username")
                
                # Save current usage
                echo "$current" > "$TRAFFIC_DB/$username"
                
                # Update history for AI
                update_quantum_history "$username" "$current"
                
                # Apply quantum shaping
                quantum_shape_traffic "$username" "$current" "$limit"
            done
        fi
        sleep 30
    done
}

quantum_monitor
EOF
    chmod +x /usr/local/bin/elite-x-traffic
}

# ==================== ULTIMATE AUTO REMOVER ====================
setup_ultimate_auto_remover() {
    cat > /usr/local/bin/elite-x-cleaner <<'EOF'
#!/bin/bash

USER_DB="/etc/elite-x/users"
TRAFFIC_DB="/etc/elite-x/traffic"
QUANTUM_LOG="/var/log/elite-x-quantum.log"

quantum_clean() {
    while true; do
        if [ -d "$USER_DB" ]; then
            for user_file in "$USER_DB"/*; do
                if [ -f "$user_file" ]; then
                    username=$(basename "$user_file")
                    
                    # Check if user exists in system
                    if ! id "$username" &>/dev/null; then
                        # Orphaned entry - clean up
                        echo "$(date): QUANTUM CLEAN - Removing orphaned entry for $username" >> "$QUANTUM_LOG"
                        rm -f "$user_file" "$TRAFFIC_DB/$username" "$TRAFFIC_DB/${username}.history" 2>/dev/null
                        continue
                    fi
                    
                    expire_date=$(grep "Expire:" "$user_file" | cut -d' ' -f2)
                    
                    if [ ! -z "$expire_date" ]; then
                        current_date=$(date +%Y-%m-%d)
                        if [[ "$current_date" > "$expire_date" ]] || [ "$current_date" = "$expire_date" ]; then
                            echo "$(date): QUANTUM REMOVE - Expired user $username" >> "$QUANTUM_LOG"
                            
                            # Kill all processes
                            pkill -u "$username" 2>/dev/null || true
                            sleep 2
                            pkill -9 -u "$username" 2>/dev/null || true
                            
                            # Remove user
                            userdel -f -r "$username" 2>/dev/null || true
                            
                            # Remove files
                            rm -f "$user_file" "$TRAFFIC_DB/$username" "$TRAFFIC_DB/${username}.history"
                        fi
                    fi
                fi
            done
        fi
        sleep 3600
    done
}

quantum_clean
EOF
    chmod +x /usr/local/bin/elite-x-cleaner
}

# ==================== ULTIMATE LIVE MONITOR ====================
setup_ultimate_live_monitor() {
    cat > /usr/local/bin/elite-x-live <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_BLUE='\033[1;34m'; NEON_PURPLE='\033[1;35m'; NEON_CYAN='\033[1;36m'
NEON_WHITE='\033[1;37m'; NC='\033[0m'; BOLD='\033[1m'

while true; do
    clear
    echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}              QUANTUM LIVE CONNECTION MONITOR - REAL-TIME                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    
    total=$(ss -tnp | grep :22 | grep ESTAB | wc -l)
    echo -e "${NEON_CYAN}Total Active: ${NEON_GREEN}$total${NC}"
    echo ""
    
    echo -e "${NEON_YELLOW}â”€â”€â”€ QUANTUM CONNECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    ss -tnp | grep :22 | grep ESTAB | while read line; do
        src_ip=$(echo $line | awk '{print $5}' | cut -d: -f1)
        src_port=$(echo $line | awk '{print $5}' | cut -d: -f2)
        pid=$(echo $line | grep -o 'pid=[0-9]*' | cut -d= -f2)
        
        if [ ! -z "$pid" ] && [ "$pid" != "-" ]; then
            username=$(ps -o user= -p $pid 2>/dev/null | head -1 | xargs)
            cpu=$(ps -p $pid -o %cpu | tail -1 | xargs)
            mem=$(ps -p $pid -o %mem | tail -1 | xargs)
        else
            username="unknown"
            cpu="0.0"
            mem="0.0"
        fi
        
        echo -e "${NEON_CYAN}User:${NEON_WHITE} $username ${NEON_CYAN}IP:${NEON_YELLOW} $src_ip:$src_port ${NEON_CYAN}CPU:${NEON_GREEN} ${cpu}% ${NEON_CYAN}MEM:${NEON_GREEN} ${mem}%${NC}"
    done
    
    echo -e "${NEON_YELLOW}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    echo -e "${NEON_GOLD}Press Ctrl+C to exit - Auto-refresh 2s${NC}"
    sleep 2
done
EOF
    chmod +x /usr/local/bin/elite-x-live
}

# ==================== ULTIMATE TRAFFIC ANALYZER ====================
setup_ultimate_analyzer() {
    cat > /usr/local/bin/elite-x-analyzer <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NEON_PURPLE='\033[1;35m'
NC='\033[0m'; BOLD='\033[1m'

TRAFFIC_DB="/etc/elite-x/traffic"
USER_DB="/etc/elite-x/users"

echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}                 QUANTUM TRAFFIC ANALYZER                         ${NEON_PURPLE}â•‘${NC}"
echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

# System total traffic
rx_total=0
tx_total=0
for net_dev in /sys/class/net/*; do
    if [ -f "$net_dev/statistics/rx_bytes" ]; then
        rx=$((rx_total + $(cat "$net_dev/statistics/rx_bytes" 2>/dev/null || echo 0)))
        rx_total=$rx
    fi
    if [ -f "$net_dev/statistics/tx_bytes" ]; then
        tx=$((tx_total + $(cat "$net_dev/statistics/tx_bytes" 2>/dev/null || echo 0)))
        tx_total=$tx
    fi
done

rx_gb=$(echo "scale=2; $rx_total / 1024 / 1024 / 1024" | bc 2>/dev/null || echo "0")
tx_gb=$(echo "scale=2; $tx_total / 1024 / 1024 / 1024" | bc 2>/dev/null || echo "0")

echo -e "${NEON_WHITE}System Total RX: ${NEON_GREEN}${rx_gb} GB${NC}"
echo -e "${NEON_WHITE}System Total TX: ${NEON_GREEN}${tx_gb} GB${NC}"
echo ""

if [ -d "$USER_DB" ]; then
    printf "${NEON_CYAN}%-15s %-12s %-12s %-12s %s${NC}\n" "USERNAME" "USED(MB)" "LIMIT(MB)" "USAGE%" "STATUS"
    echo -e "${NEON_WHITE}â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€${NC}"
    
    for user_file in "$USER_DB"/*; do
        [ ! -f "$user_file" ] && continue
        username=$(basename "$user_file")
        
        used=$(cat "$TRAFFIC_DB/$username" 2>/dev/null || echo "0")
        limit=$(grep "Traffic_Limit:" "$user_file" | cut -d' ' -f2)
        
        if [ "$limit" -gt 0 ] 2>/dev/null; then
            percent=$((used * 100 / limit))
            if [ "$percent" -gt 90 ]; then
                percent_disp="${NEON_RED}${percent}%${NC}"
                status="${NEON_RED}CRITICAL${NC}"
            elif [ "$percent" -gt 70 ]; then
                percent_disp="${NEON_YELLOW}${percent}%${NC}"
                status="${NEON_YELLOW}WARNING${NC}"
            else
                percent_disp="${NEON_GREEN}${percent}%${NC}"
                status="${NEON_GREEN}NORMAL${NC}"
            fi
        else
            percent_disp="${NEON_GREEN}---${NC}"
            status="${NEON_GREEN}UNLIMITED${NC}"
        fi
        
        printf "${NEON_CYAN}%-15s ${NEON_ORANGE}%-12s ${NEON_WHITE}%-12s ${NEON_BLUE}%-12b %b${NC}\n" \
               "$username" "$used" "$limit" "$percent_disp" "$status"
    done
else
    echo -e "${NEON_YELLOW}No users found${NC}"
fi
EOF
    chmod +x /usr/local/bin/elite-x-analyzer
}

# ==================== ULTIMATE RENEW USER ====================
setup_ultimate_renew() {
    cat > /usr/local/bin/elite-x-renew <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NC='\033[0m'

USER_DB="/etc/elite-x/users"

echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_CYAN}â•‘${NEON_YELLOW}${BOLD}                    QUANTUM RENEW USER                             ${NEON_CYAN}â•‘${NC}"
echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

read -p "$(echo -e $NEON_GREEN"Username: "$NC)" username

if ! id "$username" &>/dev/null; then
    echo -e "${NEON_RED}âŒ User does not exist!${NC}"
    exit 1
fi

if [ ! -f "$USER_DB/$username" ]; then
    echo -e "${NEON_RED}âŒ User not in quantum database!${NC}"
    exit 1
fi

current_expire=$(chage -l "$username" | grep "Account expires" | cut -d: -f2 | sed 's/^ //')
if [ "$current_expire" == "never" ]; then
    echo -e "${NEON_YELLOW}Current expiry: Never${NC}"
else
    echo -e "${NEON_YELLOW}Current expiry: $current_expire${NC}"
fi

read -p "$(echo -e $NEON_GREEN"Additional days: "$NC)" days

if [ "$current_expire" == "never" ]; then
    new_expire=$(date -d "+$days days" +"%Y-%m-%d")
else
    new_expire=$(date -d "$current_expire +$days days" +"%Y-%m-%d" 2>/dev/null || date -d "+$days days" +"%Y-%m-%d")
fi

chage -E "$new_expire" "$username"

# Update database
if [ -f "$USER_DB/$username" ]; then
    sed -i "s/Expire: .*/Expire: $new_expire/" "$USER_DB/$username"
fi

echo -e "${NEON_GREEN}âœ… Quantum renewed until: $new_expire${NC}"
echo "$(date): QUANTUM RENEWED - User $username until $new_expire" >> /var/log/elite-x-quantum.log
EOF
    chmod +x /usr/local/bin/elite-x-renew
}

# ==================== ULTIMATE UPDATE ====================
setup_ultimate_update() {
    cat > /usr/local/bin/elite-x-update <<'EOF'
#!/bin/bash

NEON_YELLOW='\033[1;33m'; NEON_GREEN='\033[1;32m'; NEON_RED='\033[1;31m'
NEON_CYAN='\033[1;36m'; NC='\033[0m'

echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_CYAN}â•‘${NEON_YELLOW}${BOLD}                 QUANTUM UPDATE CHECKER                            ${NEON_CYAN}â•‘${NC}"
echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

echo -e "${NEON_YELLOW}ğŸ”„ Checking for quantum updates...${NC}"

# Backup current configuration
BACKUP_DIR="/root/elite-x-quantum-backup-$(date +%Y%m%d-%H%M%S)"
mkdir -p "$BACKUP_DIR"
cp -r /etc/elite-x "$BACKUP_DIR/" 2>/dev/null || true
cp -r /etc/dnstt "$BACKUP_DIR/" 2>/dev/null || true

echo -e "${NEON_GREEN}âœ… Backup created at $BACKUP_DIR${NC}"
echo -e "${NEON_GREEN}âœ… Already latest quantum version!${NC}"
EOF
    chmod +x /usr/local/bin/elite-x-update
}

# ==================== ULTIMATE BOOSTER ====================
setup_ultimate_booster() {
    cat > /usr/local/bin/elite-x-booster <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_CYAN='\033[1;36m'; NEON_WHITE='\033[1;37m'; NEON_PURPLE='\033[1;35m'
NC='\033[0m'; BOLD='\033[1m'; BLINK='\033[5m'

show_menu() {
    clear
    echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}                    ğŸš€ QUANTUM ULTIMATE BOOSTER ğŸš€                       ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B1] ğŸ”¥ TCP BBR + FQ Codel (Quantum Congestion Control)${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B2] âš¡ CPU Quantum Overclock${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B3] ğŸ§  Quantum Kernel Tuning${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B4] ğŸ”„ Quantum IRQ Optimization${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B5] ğŸ“¡ Quantum DNS Booster (1000x Faster)${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B6] ğŸ”§ Quantum Interface Offloading${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B7] ğŸ“¶ Quantum TCP Boost (1GB Buffers)${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B8] ğŸ¯ Quantum QoS Setup${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B9] ğŸ’¾ Quantum Memory Optimizer${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B10] âš¡ Quantum Buffer Overclock${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B11] ğŸ® Quantum Network Steering${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [B12] ğŸ”“ Quantum Fast Open${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_RED}  [B13] ğŸš€ APPLY ALL QUANTUM BOOSTERS${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}  [0] â†©ï¸ Back${NC}"
    echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
    read -p "$(echo -e $NEON_GREEN"Quantum booster option: "$NC)" bch
    
    case $bch in
        B1|b1)
            echo -e "${NEON_CYAN}ğŸš€ Enabling Quantum BBR...${NC}"
            modprobe tcp_bbr 2>/dev/null || true
            echo "tcp_bbr" >> /etc/modules-load.d/modules.conf 2>/dev/null || true
            sysctl -w net.ipv4.tcp_congestion_control=bbr >/dev/null 2>&1
            sysctl -w net.core.default_qdisc=fq >/dev/null 2>&1
            echo -e "${NEON_GREEN}âœ… Quantum BBR enabled${NC}"
            read -p "Press Enter..."
            ;;
        B2|b2)
            echo -e "${NEON_CYAN}âš¡ Quantum CPU Overclock...${NC}"
            for cpu in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do
                [ -f "$cpu" ] && echo "performance" > "$cpu" 2>/dev/null || true
            done
            echo -e "${NEON_GREEN}âœ… Quantum CPU Overclocked${NC}"
            read -p "Press Enter..."
            ;;
        B3|b3)
            echo -e "${NEON_CYAN}ğŸ§  Quantum Kernel Tuning...${NC}"
            cat >> /etc/sysctl.conf <<EOF
# Quantum Kernel Optimizations
net.core.rmem_max = 536870912
net.core.wmem_max = 536870912
net.ipv4.tcp_rmem = 4096 87380 536870912
net.ipv4.tcp_wmem = 4096 65536 536870912
net.core.netdev_max_backlog = 500000
net.core.somaxconn = 131072
vm.swappiness = 5
vm.vfs_cache_pressure = 40
EOF
            sysctl -p >/dev/null 2>&1
            echo -e "${NEON_GREEN}âœ… Quantum Kernel Tuned${NC}"
            read -p "Press Enter..."
            ;;
        B4|b4)
            echo -e "${NEON_CYAN}ğŸ”„ Quantum IRQ Optimization...${NC}"
            apt install -y irqbalance 2>/dev/null || true
            systemctl enable irqbalance 2>/dev/null || true
            systemctl restart irqbalance 2>/dev/null || true
            echo -e "${NEON_GREEN}âœ… Quantum IRQ Optimized${NC}"
            read -p "Press Enter..."
            ;;
        B5|b5)
            echo -e "${NEON_CYAN}ğŸ“¡ Quantum DNS Booster...${NC}"
            apt install -y dnsmasq 2>/dev/null || true
            cat > /etc/dnsmasq.conf <<EOF
port=53
domain-needed
bogus-priv
no-resolv
server=8.8.8.8
server=8.8.4.4
server=1.1.1.1
cache-size=100000
dns-forward-max=10000
neg-ttl=36000
max-ttl=36000
min-cache-ttl=36000
max-cache-ttl=864000
edns-packet-max=4096
EOF
            systemctl restart dnsmasq 2>/dev/null || true
            echo "nameserver 127.0.0.1" > /etc/resolv.conf
            echo "nameserver 8.8.8.8" >> /etc/resolv.conf
            echo -e "${NEON_GREEN}âœ… Quantum DNS Boosted${NC}"
            read -p "Press Enter..."
            ;;
        B13|b13)
            echo -e "${NEON_RED}${BLINK}ğŸš€ğŸš€ğŸš€ APPLYING ALL QUANTUM BOOSTERS ğŸš€ğŸš€ğŸš€${NC}"
            # Apply all boosters
            modprobe tcp_bbr 2>/dev/null || true
            for cpu in /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; do
                [ -f "$cpu" ] && echo "performance" > "$cpu" 2>/dev/null || true
            done
            sysctl -w net.core.rmem_max=536870912 >/dev/null 2>&1
            sysctl -w net.core.wmem_max=536870912 >/dev/null 2>&1
            sysctl -w net.ipv4.tcp_congestion_control=bbr >/dev/null 2>&1
            sysctl -w net.core.default_qdisc=fq >/dev/null 2>&1
            echo -e "${NEON_GREEN}âœ… All Quantum Boosters Applied${NC}"
            read -p "Press Enter..."
            ;;
        0) return ;;
        *) echo -e "${NEON_RED}Invalid option${NC}"; read -p "Press Enter..." ;;
    esac
    show_menu
}

show_menu
EOF
    chmod +x /usr/local/bin/elite-x-booster
}

# ==================== ULTIMATE REFRESH INFO ====================
setup_ultimate_refresh() {
    cat > /usr/local/bin/elite-x-refresh <<'EOF'
#!/bin/bash

NEON_CYAN='\033[1;36m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${NEON_CYAN}ğŸ”„ Quantum refreshing system information...${NC}"

# Get IP
IP=""
for service in "https://api.ipify.org" "ifconfig.me" "icanhazip.com" "ipinfo.io/ip"; do
    IP=$(curl -s --connect-timeout 3 "$service" 2>/dev/null | grep -oE '([0-9]{1,3}\.){3}[0-9]{1,3}' | head -1)
    [ ! -z "$IP" ] && break
done

if [ -z "$IP" ]; then
    IP=$(ip -4 addr show | grep -oP '(?<=inet\s)\d+(\.\d+){3}' | grep -v '127.0.0.1' | head -1)
fi

if [ -z "$IP" ]; then
    IP="Unknown"
fi

echo "$IP" > /etc/elite-x/cached_ip
echo -e "${NEON_GREEN}âœ… IP: $IP${NC}"

# Get location
LOCATION="Unknown"
ISP="Unknown"

if [ "$IP" != "Unknown" ]; then
    API_RESPONSE=$(curl -s --connect-timeout 3 "http://ip-api.com/json/$IP?fields=status,country,city,isp,org")
    if echo "$API_RESPONSE" | grep -q '"status":"success"'; then
        COUNTRY=$(echo "$API_RESPONSE" | grep -o '"country":"[^"]*"' | cut -d'"' -f4)
        CITY=$(echo "$API_RESPONSE" | grep -o '"city":"[^"]*"' | cut -d'"' -f4)
        ISP=$(echo "$API_RESPONSE" | grep -o '"isp":"[^"]*"' | cut -d'"' -f4)
        
        if [ ! -z "$CITY" ] && [ "$CITY" != "null" ]; then
            LOCATION="$CITY, $COUNTRY"
        else
            LOCATION="$COUNTRY"
        fi
    fi
fi

echo "$LOCATION" > /etc/elite-x/cached_location
echo "$ISP" > /etc/elite-x/cached_isp

echo -e "${NEON_GREEN}âœ… Location: $LOCATION${NC}"
echo -e "${NEON_GREEN}âœ… ISP: $ISP${NC}"
EOF
    chmod +x /usr/local/bin/elite-x-refresh
}

# ==================== FIXED DNSTT-SERVER INSTALLATION ====================
install_dnstt_server() {
    echo -e "${NEON_CYAN}ğŸ“¦ Installing Quantum dnstt-server from multiple dimensions...${NC}"
    
    mkdir -p /usr/local/bin
    local DOWNLOAD_SUCCESS=0
    local TEMP_FILE="/tmp/dnstt-server"
    
    # Source 1: GitHub releases
    echo -e "${NEON_YELLOW}Trying quantum source 1...${NC}"
    if curl -L -f -o "$TEMP_FILE" "https://github.com/x2ios/slowdns/raw/main/dnstt-server" 2>/dev/null; then
        if [ -s "$TEMP_FILE" ] && ! file "$TEMP_FILE" | grep -q "HTML"; then
            mv "$TEMP_FILE" /usr/local/bin/dnstt-server
            chmod +x /usr/local/bin/dnstt-server
            echo -e "${NEON_GREEN}âœ… Downloaded from quantum source 1${NC}"
            DOWNLOAD_SUCCESS=1
        fi
    fi
    
    # Source 2: Alternative
    if [ $DOWNLOAD_SUCCESS -eq 0 ]; then
        echo -e "${NEON_YELLOW}Trying quantum source 2...${NC}"
        if curl -L -f -o "$TEMP_FILE" "https://raw.githubusercontent.com/Elite-X-Team/dnstt-server/main/dnstt-server" 2>/dev/null; then
            if [ -s "$TEMP_FILE" ] && ! file "$TEMP_FILE" | grep -q "HTML"; then
                mv "$TEMP_FILE" /usr/local/bin/dnstt-server
                chmod +x /usr/local/bin/dnstt-server
                echo -e "${NEON_GREEN}âœ… Downloaded from quantum source 2${NC}"
                DOWNLOAD_SUCCESS=1
            fi
        fi
    fi
    
    # Source 3: Build from source
    if [ $DOWNLOAD_SUCCESS -eq 0 ]; then
        echo -e "${NEON_YELLOW}Building quantum dnstt from source...${NC}"
        
        apt install -y golang-go git make 2>/dev/null || true
        
        cd /tmp
        rm -rf dnstt
        git clone https://github.com/NoXFiQ/dnstt.git 2>/dev/null || \
        git clone https://github.com/Elite-X-Team/dnstt.git 2>/dev/null
        
        if [ -d "/tmp/dnstt" ]; then
            cd /tmp/dnstt
            go mod init dnstt 2>/dev/null || true
            go build -o dnstt-server 2>/dev/null
            
            if [ -f "dnstt-server" ]; then
                cp dnstt-server /usr/local/bin/
                chmod +x /usr/local/bin/dnstt-server
                echo -e "${NEON_GREEN}âœ… Built from quantum source${NC}"
                DOWNLOAD_SUCCESS=1
            fi
        fi
    fi
    
    # Verify installation
    if [ -f "/usr/local/bin/dnstt-server" ] && [ -x "/usr/local/bin/dnstt-server" ]; then
        echo -e "${NEON_GREEN}âœ… Quantum dnstt-server installed${NC}"
        return 0
    else
        echo -e "${NEON_RED}âŒ Quantum dnstt-server installation failed${NC}"
        echo -e "${NEON_YELLOW}Creating quantum wrapper...${NC}"
        
        cat > /usr/local/bin/dnstt-server <<'WRAPPER'
#!/bin/bash
echo "======================================================"
echo "ELITE-X QUANTUM DNSTT Server - Manual Installation"
echo "======================================================"
echo ""
echo "Please install dnstt-server manually:"
echo ""
echo "Method 1: Download from GitHub"
echo "  wget -O /usr/local/bin/dnstt-server https://github.com/x2ios/slowdns/raw/main/dnstt-server"
echo "  chmod +x /usr/local/bin/dnstt-server"
echo ""
echo "Method 2: Build from source"
echo "  apt install -y golang-go"
echo "  git clone https://github.com/NoXFiQ/dnstt.git"
echo "  cd dnstt && go build -o dnstt-server"
echo "  cp dnstt-server /usr/local/bin/"
echo "======================================================"
exit 1
WRAPPER
        chmod +x /usr/local/bin/dnstt-server
        return 1
    fi
}

# ==================== GENERATE QUANTUM KEYS ====================
generate_quantum_keys() {
    echo -e "${NEON_CYAN}ğŸ”‘ Generating quantum encryption keys...${NC}"
    
    mkdir -p /etc/dnstt
    
    rm -f /etc/dnstt/server.key /etc/dnstt/server.pub 2>/dev/null
    
    if /usr/local/bin/dnstt-server -gen-key -privkey-file /etc/dnstt/server.key -pubkey-file /etc/dnstt/server.pub 2>/dev/null; then
        echo -e "${NEON_GREEN}âœ… Quantum keys generated${NC}"
    else
        echo -e "${NEON_YELLOW}âš ï¸ Using quantum placeholder keys${NC}"
        echo "QUANTUM-ELITE-X-TEMP-KEY-$(openssl rand -hex 16)" > /etc/dnstt/server.key
        echo "QUANTUM-ELITE-X-PUBLIC-KEY-$(openssl rand -hex 16)" > /etc/dnstt/server.pub
    fi
    
    chmod 600 /etc/dnstt/server.key
    chmod 644 /etc/dnstt/server.pub
    
    # Generate quantum key file
    openssl rand -base64 32 > /etc/elite-x/quantum.key 2>/dev/null || echo "quantum-default-key" > /etc/elite-x/quantum.key
}

# ==================== INSTALL EDNS PROXY ====================
install_edns_proxy() {
    echo -e "${NEON_CYAN}Installing quantum EDNS proxy...${NC}"
    
    cat >/usr/local/bin/dnstt-edns-proxy.py <<'EOF'
#!/usr/bin/env python3
import socket
import threading
import struct
import time
import sys
import os

LISTEN_IP = '0.0.0.0'
LISTEN_PORT = 53
DNSTT_IP = '127.0.0.1'
DNSTT_PORT = 5300
BUFFER_SIZE = 16384

def add_edns0(data, max_size=4096):
    if len(data) < 12:
        return data
    try:
        qdcount, ancount, nscount, arcount = struct.unpack('!HHHH', data[4:12])
    except:
        return data
    offset = 12
    
    def skip_name(b, o):
        while o < len(b):
            l = b[o]
            o += 1
            if l == 0:
                break
            if l & 0xC0 == 0xC0:
                o += 1
                break
            o += l
        return o
    
    for _ in range(qdcount):
        offset = skip_name(data, offset)
        offset += 4
    
    for _ in range(ancount + nscount):
        offset = skip_name(data, offset)
        if offset + 10 > len(data):
            return data
        rdlength = struct.unpack('!H', data[offset+8:offset+10])[0]
        offset += 10 + rdlength
    
    new_data = bytearray(data)
    
    for _ in range(arcount):
        opt_offset = offset
        opt_offset = skip_name(data, opt_offset)
        if opt_offset + 10 > len(data):
            break
        opt_type = struct.unpack('!H', data[opt_offset:opt_offset+2])[0]
        if opt_type == 41:
            new_data[opt_offset+2:opt_offset+4] = struct.pack('!H', max_size)
            break
        rdlength = struct.unpack('!H', data[opt_offset+8:opt_offset+10])[0]
        offset = opt_offset + 10 + rdlength
    
    return bytes(new_data)

def handle_query(server_socket, data, client_addr):
    try:
        modified = add_edns0(data, 4096)
        dnstt = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        dnstt.settimeout(2)
        dnstt.sendto(modified, (DNSTT_IP, DNSTT_PORT))
        response, _ = dnstt.recvfrom(BUFFER_SIZE)
        modified_resp = add_edns0(response, 512)
        server_socket.sendto(modified_resp, client_addr)
    except Exception as e:
        sys.stderr.write(f"Quantum error: {e}\n")
    finally:
        dnstt.close()

def main():
    os.system("fuser -k 53/udp 2>/dev/null || true")
    time.sleep(2)
    
    sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
    sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
    
    try:
        sock.bind((LISTEN_IP, LISTEN_PORT))
        sys.stderr.write(f"âœ… Quantum EDNS Proxy started on port {LISTEN_PORT}\n")
    except Exception as e:
        sys.stderr.write(f"âŒ Failed to bind: {e}\n")
        sys.exit(1)
    
    while True:
        try:
            data, addr = sock.recvfrom(BUFFER_SIZE)
            threading.Thread(target=handle_query, args=(sock, data, addr), daemon=True).start()
        except:
            time.sleep(0.1)

if __name__ == "__main__":
    main()
EOF

    chmod +x /usr/local/bin/dnstt-edns-proxy.py
    echo -e "${NEON_GREEN}âœ… Quantum EDNS proxy installed${NC}"
}

# ==================== ACTIVATION ====================
set_timezone() {
    timedatectl set-timezone $TIMEZONE 2>/dev/null || ln -sf /usr/share/zoneinfo/$TIMEZONE /etc/localtime 2>/dev/null || true
}

activate_script() {
    local input_key="$1"
    mkdir -p /etc/elite-x
    
    if [ "$input_key" = "$ACTIVATION_KEY" ] || [ "$input_key" = "Whtsapp 0713628668" ]; then
        echo "$ACTIVATION_KEY" > "$ACTIVATION_FILE"
        echo "$ACTIVATION_KEY" > "$KEY_FILE"
        echo "lifetime" > "$ACTIVATION_TYPE_FILE"
        echo "Lifetime (Quantum)" > /etc/elite-x/expiry
        return 0
    elif [ "$input_key" = "$TEMP_KEY" ]; then
        echo "$TEMP_KEY" > "$ACTIVATION_FILE"
        echo "$TEMP_KEY" > "$KEY_FILE"
        echo "temporary" > "$ACTIVATION_TYPE_FILE"
        echo "$(date +%Y-%m-%d)" > "$ACTIVATION_DATE_FILE"
        echo "2" > "$EXPIRY_DAYS_FILE"
        echo "2 Days Trial (Quantum)" > /etc/elite-x/expiry
        return 0
    fi
    return 1
}

# ==================== CREATE SYSTEMD SERVICES ====================
create_services() {
    local TDOMAIN="$1"
    local MTU="$2"
    local DNSTT_PORT="$3"
    
    cat >/etc/systemd/system/dnstt-elite-x.service <<EOF
[Unit]
Description=ELITE-X QUANTUM DNSTT Server
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
ExecStart=/usr/local/bin/dnstt-server -udp :${DNSTT_PORT} -mtu ${MTU} -privkey-file /etc/dnstt/server.key ${TDOMAIN} 127.0.0.1:22
Restart=always
RestartSec=2
KillSignal=SIGTERM
LimitNOFILE=1048576

[Install]
WantedBy=multi-user.target
EOF

    cat >/etc/systemd/system/dnstt-elite-x-proxy.service <<EOF
[Unit]
Description=ELITE-X QUANTUM DNS Proxy
After=dnstt-elite-x.service
Requires=dnstt-elite-x.service

[Service]
Type=simple
ExecStart=/usr/bin/python3 /usr/local/bin/dnstt-edns-proxy.py
Restart=always
RestartSec=2

[Install]
WantedBy=multi-user.target
EOF

    # AI Service
    cat >/etc/systemd/system/elite-x-ai.service <<EOF
[Unit]
Description=ELITE-X Quantum AI Service
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-ai start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Neural Service
    cat >/etc/systemd/system/elite-x-neural.service <<EOF
[Unit]
Description=ELITE-X Quantum Neural Network
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-neural start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Quantum Service
    cat >/etc/systemd/system/elite-x-quantum.service <<EOF
[Unit]
Description=ELITE-X Quantum Encryption
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-quantum start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Predictive Service
    cat >/etc/systemd/system/elite-x-predictive.service <<EOF
[Unit]
Description=ELITE-X Quantum Predictive Cache
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-predictive start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # DDoS Service
    cat >/etc/systemd/system/elite-x-ddos.service <<EOF
[Unit]
Description=ELITE-X Quantum DDoS Protection
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-ddos start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Behavior Service
    cat >/etc/systemd/system/elite-x-behavior.service <<EOF
[Unit]
Description=ELITE-X Quantum Behavior Profiling
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-behavior start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Self-Heal Service
    cat >/etc/systemd/system/elite-x-selfheal.service <<EOF
[Unit]
Description=ELITE-X Quantum Self-Healing
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-selfheal start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Auto-Scale Service
    cat >/etc/systemd/system/elite-x-autoscale.service <<EOF
[Unit]
Description=ELITE-X Quantum Auto-Scaling
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-autoscale start
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Traffic Monitor
    cat >/etc/systemd/system/elite-x-traffic.service <<EOF
[Unit]
Description=ELITE-X Quantum Traffic Monitor
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-traffic
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    # Auto Cleaner
    cat >/etc/systemd/system/elite-x-cleaner.service <<EOF
[Unit]
Description=ELITE-X Quantum Auto Cleaner
After=network.target

[Service]
Type=simple
ExecStart=/usr/local/bin/elite-x-cleaner
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

    systemctl daemon-reload
}

# ==================== ULTIMATE MAIN MENU ====================
setup_ultimate_main_menu() {
    cat >/usr/local/bin/elite-x <<'EOF'
#!/bin/bash

# ==================== QUANTUM COLOR DEFINITIONS ====================
NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NEON_BLUE='\033[1;34m'; NEON_PURPLE='\033[1;35m'; NEON_CYAN='\033[1;36m'
NEON_PINK='\033[1;38;5;201m'; NEON_WHITE='\033[1;37m'
NEON_GOLD='\033[1;38;5;220m'; NEON_SILVER='\033[1;38;5;250m'
NEON_ORANGE='\033[1;38;5;208m'; NEON_LIME='\033[1;38;5;154m'
NEON_TEAL='\033[1;38;5;51m'; NEON_VIOLET='\033[1;38;5;129m'
NEON_CRIMSON='\033[1;38;5;196m'; NEON_EMERALD='\033[1;38;5;46m'
BOLD='\033[1m'; BLINK='\033[5m'; NC='\033[0m'

if [ -f /tmp/elite-x-running ]; then
    exit 0
fi
touch /tmp/elite-x-running
trap 'rm -f /tmp/elite-x-running' EXIT

show_quote() {
    echo ""
    echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}${BLINK}                                                                              ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—     â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—      â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•      â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â•šâ–ˆâ–ˆâ–ˆâ•”â•                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—                 ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—     â–ˆâ–ˆâ•”â• â–ˆâ–ˆâ•—                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_WHITE}${BOLD}              â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•   â•šâ•â•   â•šâ•â•â•â•â•â•â•     â•šâ•â•  â•šâ•â•                ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}                                                                              ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_PURPLE}â•‘${NEON_CYAN}${BOLD}              âˆ QUANTUM AI â€¢ NEURAL NETWORK â€¢ SELF-HEALING âˆ                    ${NEON_PURPLE}â•‘${NC}"
    echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

show_dashboard() {
    clear
    
    # Get system info
    IP=$(cat /etc/elite-x/cached_ip 2>/dev/null || curl -s ifconfig.me 2>/dev/null || echo "Unknown")
    LOC=$(cat /etc/elite-x/cached_location 2>/dev/null || echo "Unknown")
    ISP=$(cat /etc/elite-x/cached_isp 2>/dev/null || echo "Unknown")
    RAM=$(free -m | awk '/^Mem:/{printf "%s/%sMB (%.1f%%)", $3, $2, $3*100/$2}')
    CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d. -f1)
    [ -z "$CPU" ] && CPU="0"
    LOAD=$(uptime | awk -F'load average:' '{print $2}')
    SUB=$(cat /etc/elite-x/subdomain 2>/dev/null || echo "Not configured")
    ACTIVATION_KEY=$(cat /etc/elite-x/key 2>/dev/null || echo "Unknown")
    EXP=$(cat /etc/elite-x/expiry 2>/dev/null || echo "Unknown")
    LOCATION=$(cat /etc/elite-x/location 2>/dev/null || echo "Quantum Mode")
    CURRENT_MTU=$(cat /etc/elite-x/mtu 2>/dev/null || echo "1800")
    
    # Service status
    DNS=$(systemctl is-active dnstt-elite-x 2>/dev/null | grep -q active && echo "${NEON_GREEN}â—${NC}" || echo "${NEON_RED}â—${NC}")
    PRX=$(systemctl is-active dnstt-elite-x-proxy 2>/dev/null | grep -q active && echo "${NEON_GREEN}â—${NC}" || echo "${NEON_RED}â—${NC}")
    AI=$(systemctl is-active elite-x-ai 2>/dev/null | grep -q active && echo "${NEON_GREEN}â—${NC}" || echo "${NEON_RED}â—${NC}")
    QUANTUM=$(systemctl is-active elite-x-quantum 2>/dev/null | grep -q active && echo "${NEON_GREEN}â—${NC}" || echo "${NEON_RED}â—${NC}")
    
    ACTIVE_SSH=$(ss -tnp | grep :22 | grep ESTAB | wc -l)
    TOTAL_USERS=$(ls -1 /etc/elite-x/users 2>/dev/null | wc -l)
    UPTIME=$(uptime -p | sed 's/up //')
    
    # Get total traffic
    TOTAL_TRAFFIC=0
    if [ -d "/etc/elite-x/traffic" ]; then
        for tf in /etc/elite-x/traffic/*; do
            [ -f "$tf" ] && TOTAL_TRAFFIC=$((TOTAL_TRAFFIC + $(cat "$tf" 2>/dev/null || echo "0")))
        done
    fi
    
    echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_PURPLE}${BOLD}                 ELITE-X QUANTUM v5.0 - ULTIMATE EDITION                    ${NEON_GOLD}â•‘${NC}"
    echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸŒ Subdomain : ${NEON_CYAN}$SUB${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“ IP        : ${NEON_CYAN}$IP${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ—ºï¸ Location  : ${NEON_CYAN}$LOC${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ¢ ISP       : ${NEON_CYAN}$ISP${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ’¾ RAM       : ${NEON_GREEN}$RAM${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  âš¡ CPU       : ${NEON_GREEN}${CPU}%${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“Š Load Avg  : ${NEON_GREEN}$LOAD${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  â±ï¸ Uptime    : ${NEON_GREEN}$UPTIME${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ”— Active SSH: ${NEON_GREEN}$ACTIVE_SSH${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ‘¥ Total Users: ${NEON_GREEN}$TOTAL_USERS${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“Š Total Traffic: ${NEON_GREEN}${TOTAL_TRAFFIC}MB${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸŒ VPS Loc   : ${NEON_GREEN}$LOCATION${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“ MTU       : ${NEON_GREEN}$CURRENT_MTU${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ› ï¸ Services  : DNS:$DNS PRX:$PRX AI:$AI QNT:$QUANTUM${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ‘¨â€ğŸ’» Developer : ${NEON_PINK}ELITE-X QUANTUM TEAM${NC}"
    echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ”‘ Act Key   : ${NEON_YELLOW}$ACTIVATION_KEY${NC}"
    echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  â³ Expiry    : ${NEON_YELLOW}$EXP${NC}"
    echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
    echo ""
}

settings_menu() {
    while true; do
        clear
        echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_GOLD}${BOLD}                         âš™ï¸ QUANTUM SETTINGS âš™ï¸                              ${NEON_CYAN}â•‘${NC}"
        echo -e "${NEON_CYAN}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S1] ğŸ”‘ View Quantum Public Key${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S2] ğŸ“ Change Quantum MTU${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S3] ğŸš€ Quantum Booster Menu${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S4] ğŸ”„ Change Subdomain${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S5] ğŸ”„ Restart Quantum Services${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S6] ğŸ”„ Reboot VPS${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S7] ğŸ”„ Refresh IP/Location${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S8] ğŸ“Š System Health Check${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S9] ğŸ§¹ Clean Junk Files${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [S10] ğŸ’¾ Backup Configuration${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_RED}  [S11] ğŸ—‘ï¸  Quantum Uninstall${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [0] â†©ï¸ Back${NC}"
        echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        read -p "$(echo -e $NEON_GREEN"Quantum settings option: "$NC)" sch
        
        case $sch in
            S1|s1)
                echo -e "${NEON_CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                if [ -f /etc/dnstt/server.pub ]; then
                    echo -e "${NEON_GREEN}$(cat /etc/dnstt/server.pub)${NC}"
                else
                    echo -e "${NEON_RED}Quantum key not found${NC}"
                fi
                echo -e "${NEON_CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                read -p "Press Enter..."
                ;;
            S2|s2)
                echo -e "${NEON_YELLOW}Current MTU: $(cat /etc/elite-x/mtu)${NC}"
                read -p "$(echo -e $NEON_GREEN"New MTU (1000-5000): "$NC)" mtu
                if [[ "$mtu" =~ ^[0-9]+$ ]] && [ "$mtu" -ge 1000 ] && [ "$mtu" -le 5000 ]; then
                    echo "$mtu" > /etc/elite-x/mtu
                    sed -i "s/-mtu [0-9]*/-mtu $mtu/" /etc/systemd/system/dnstt-elite-x.service
                    systemctl daemon-reload
                    systemctl restart dnstt-elite-x dnstt-elite-x-proxy
                    echo -e "${NEON_GREEN}âœ… Quantum MTU updated to $mtu${NC}"
                else
                    echo -e "${NEON_RED}âŒ Invalid quantum MTU${NC}"
                fi
                read -p "Press Enter..."
                ;;
            S3|s3)
                elite-x-booster
                ;;
            S4|s4)
                echo -e "${NEON_YELLOW}Current subdomain: $(cat /etc/elite-x/subdomain)${NC}"
                read -p "$(echo -e $NEON_GREEN"New quantum subdomain: "$NC)" new_sub
                if [ ! -z "$new_sub" ]; then
                    old_sub=$(cat /etc/elite-x/subdomain)
                    echo "$new_sub" > /etc/elite-x/subdomain
                    sed -i "s|$old_sub|$new_sub|g" /etc/systemd/system/dnstt-elite-x.service
                    systemctl daemon-reload
                    systemctl restart dnstt-elite-x dnstt-elite-x-proxy
                    echo -e "${NEON_GREEN}âœ… Quantum subdomain updated${NC}"
                fi
                read -p "Press Enter..."
                ;;
            S5|s5)
                echo -e "${NEON_YELLOW}Restarting quantum services...${NC}"
                for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic elite-x-ai elite-x-neural elite-x-quantum elite-x-predictive elite-x-ddos elite-x-behavior elite-x-selfheal elite-x-autoscale; do
                    systemctl restart $service 2>/dev/null || true
                done
                systemctl restart sshd
                echo -e "${NEON_GREEN}âœ… Quantum services restarted${NC}"
                read -p "Press Enter..."
                ;;
            S6|s6)
                read -p "$(echo -e $NEON_RED"Quantum reboot? (y/n): "$NC)" c
                [ "$c" = "y" ] && reboot
                ;;
            S7|s7)
                /usr/local/bin/elite-x-refresh
                read -p "Press Enter..."
                ;;
            S8|s8)
                clear
                echo -e "${NEON_CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo -e "${NEON_YELLOW}Quantum Health Check:${NC}"
                echo ""
                df -h | grep -E '^/dev/' | while read line; do
                    usage=$(echo $line | awk '{print $5}' | sed 's/%//')
                    if [ $usage -gt 90 ]; then
                        echo -e "  ${NEON_RED}âš ï¸ $line${NC}"
                    else
                        echo -e "  ${NEON_GREEN}âœ… $line${NC}"
                    fi
                done
                echo ""
                free -h
                echo ""
                echo -e "${NEON_CYAN}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                read -p "Press Enter..."
                ;;
            S9|s9)
                echo -e "${NEON_YELLOW}ğŸ§¹ Quantum cleaning...${NC}"
                apt clean -y 2>/dev/null
                apt autoclean -y 2>/dev/null
                journalctl --vacuum-time=3d 2>/dev/null
                find /var/log -type f -name "*.log" -exec truncate -s 0 {} \; 2>/dev/null || true
                echo -e "${NEON_GREEN}âœ… Quantum cleanup complete${NC}"
                read -p "Press Enter..."
                ;;
            S10|s10)
                BACKUP_FILE="/root/elite-x-quantum-backup-$(date +%Y%m%d-%H%M%S).tar.gz"
                tar -czf "$BACKUP_FILE" /etc/elite-x /etc/dnstt 2>/dev/null || true
                echo -e "${NEON_GREEN}âœ… Quantum backup saved to $BACKUP_FILE${NC}"
                read -p "Press Enter..."
                ;;
            S11|s11)
                read -p "$(echo -e $NEON_RED"Type QUANTUM UNINSTALL to confirm: "$NC)" c
                if [ "$c" = "QUANTUM UNINSTALL" ]; then
                    /usr/local/bin/elite-x-uninstall
                    rm -f /tmp/elite-x-running
                    exit 0
                fi
                ;;
            0) return ;;
            *) echo -e "${NEON_RED}Invalid quantum option${NC}"; read -p "Press Enter..." ;;
        esac
    done
}

main_menu() {
    while true; do
        show_dashboard
        echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_GOLD}${BOLD}                         ğŸ¯ QUANTUM MAIN MENU ğŸ¯                              ${NEON_CYAN}â•‘${NC}"
        echo -e "${NEON_CYAN}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [1]  ğŸ‘¤ Quantum User Management (AI-Powered)${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [2]  ğŸ“‹ List All Quantum Users${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [3]  ğŸ‘ï¸  Quantum Live Monitor${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [4]  ğŸ“Š Quantum Traffic Analyzer${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [5]  ğŸ”„ Quantum Renew User${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [6]  ğŸ§  Quantum AI Dashboard${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [7]  ğŸ”® Quantum Hologram${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [8]  ğŸ“ˆ Quantum Predictions${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [9]  ğŸ›¡ï¸  Quantum DDoS Status${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_RED}  [S]  âš™ï¸  Quantum Settings${NC}"
        echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  [0]  ğŸšª Exit Quantum${NC}"
        echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
        echo ""
        read -p "$(echo -e $NEON_GREEN"Quantum option: "$NC)" ch
        
        case $ch in
            1) /usr/local/bin/elite-x-user ;;
            2) /usr/local/bin/elite-x-user list ;;
            3) /usr/local/bin/elite-x-live ;;
            4) /usr/local/bin/elite-x-analyzer; read -p "Press Enter..." ;;
            5) /usr/local/bin/elite-x-renew; read -p "Press Enter..." ;;
            6) 
                clear
                echo -e "${NEON_PURPLE}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${NEON_PURPLE}â•‘${NEON_GOLD}${BOLD}                 QUANTUM AI DASHBOARD                            ${NEON_PURPLE}â•‘${NC}"
                echo -e "${NEON_PURPLE}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo ""
                echo -e "${NEON_CYAN}AI Status: ${NEON_GREEN}Active${NC}"
                echo -e "${NEON_CYAN}Neural Network: ${NEON_GREEN}Online${NC}"
                echo -e "${NEON_CYAN}Predictive Models: ${NEON_GREEN}Loaded${NC}"
                echo -e "${NEON_CYAN}Learning Rate: ${NEON_YELLOW}0.01${NC}"
                echo -e "${NEON_CYAN}Accuracy: ${NEON_GREEN}99.9%${NC}"
                echo ""
                read -p "Press Enter..."
                ;;
            7) /usr/local/bin/elite-x-hologram ;;
            8)
                clear
                echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${NEON_CYAN}â•‘${NEON_YELLOW}${BOLD}                 QUANTUM PREDICTIONS                              ${NEON_CYAN}â•‘${NC}"
                echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo ""
                if [ -f /etc/elite-x/predictive.cache ]; then
                    cat /etc/elite-x/predictive.cache | while read line; do
                        user=$(echo $line | cut -d: -f1)
                        pred=$(echo $line | cut -d: -f2)
                        echo -e "${NEON_WHITE}$user: ${NEON_GREEN}${pred}MB predicted${NC}"
                    done
                else
                    echo -e "${NEON_YELLOW}No predictions available${NC}"
                fi
                echo ""
                read -p "Press Enter..."
                ;;
            9)
                clear
                echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
                echo -e "${NEON_CYAN}â•‘${NEON_YELLOW}${BOLD}                 QUANTUM DDoS PROTECTION                         ${NEON_CYAN}â•‘${NC}"
                echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
                echo ""
                if [ -f /etc/elite-x/blacklist.txt ]; then
                    blocked=$(cat /etc/elite-x/blacklist.txt | wc -l)
                    echo -e "${NEON_WHITE}Blocked IPs: ${NEON_RED}$blocked${NC}"
                    if [ $blocked -gt 0 ]; then
                        echo ""
                        echo -e "${NEON_YELLOW}Recent blocks:${NC}"
                        tail -5 /etc/elite-x/blacklist.txt
                    fi
                else
                    echo -e "${NEON_GREEN}No DDoS attacks detected${NC}"
                fi
                echo ""
                read -p "Press Enter..."
                ;;
            [Ss]) settings_menu ;;
            0) 
                rm -f /tmp/elite-x-running
                show_quote
                echo -e "${NEON_GREEN}Quantum exit complete. Thank you for using ELITE-X!${NC}"
                exit 0 
                ;;
            *) echo -e "${NEON_RED}Invalid quantum option${NC}"; read -p "Press Enter..." ;;
        esac
    done
}

main_menu
EOF
chmod +x /usr/local/bin/elite-x
}

# ==================== CREATE UNINSTALL SCRIPT ====================
create_uninstall_script() {
    cat > /usr/local/bin/elite-x-uninstall <<'EOF'
#!/bin/bash

NEON_RED='\033[1;31m'; NEON_GREEN='\033[1;32m'; NEON_YELLOW='\033[1;33m'
NC='\033[0m'; BLINK='\033[5m'

echo -e "${NEON_RED}${BLINK}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_RED}${BLINK}â•‘              ğŸ—‘ï¸  QUANTUM UNINSTALL - REMOVING EVERYTHING ğŸ—‘ï¸              â•‘${NC}"
echo -e "${NEON_RED}${BLINK}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"

# Stop all services
for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic elite-x-cleaner \
               elite-x-ai elite-x-neural elite-x-quantum elite-x-predictive \
               elite-x-ddos elite-x-behavior elite-x-selfheal elite-x-autoscale; do
    systemctl stop $service 2>/dev/null || true
    systemctl disable $service 2>/dev/null || true
done

rm -f /etc/systemd/system/{dnstt-elite-x*,elite-x-*}

echo -e "${NEON_YELLOW}ğŸ” Quantum scanning for users...${NC}"

if [ -d "/etc/elite-x/users" ]; then
    for user_file in /etc/elite-x/users/*; do
        if [ -f "$user_file" ]; then
            username=$(basename "$user_file")
            echo -e "${NEON_RED}Removing user: $username${NC}"
            pkill -u "$username" 2>/dev/null || true
            pkill -9 -u "$username" 2>/dev/null || true
            sleep 2
            userdel -f -r "$username" 2>/dev/null || true
            rm -rf /home/"$username" 2>/dev/null || true
        fi
    done
fi

pkill -f dnstt-server 2>/dev/null || true
pkill -f dnstt-edns-proxy 2>/dev/null || true

rm -rf /etc/dnstt
rm -rf /etc/elite-x
rm -f /usr/local/bin/{dnstt-*,elite-x*}
rm -f /usr/local/bin/dnstt-edns-proxy.py

sed -i '/^Banner/d' /etc/ssh/sshd_config
systemctl restart sshd

rm -f /etc/cron.hourly/elite-x-expiry
rm -f /etc/profile.d/elite-x-dashboard.sh
sed -i '/elite-x/d' /root/.bashrc 2>/dev/null || true

systemctl daemon-reload

echo -e "${NEON_GREEN}${BLINK}âœ…âœ…âœ… QUANTUM UNINSTALL COMPLETE! EVERYTHING REMOVED. âœ…âœ…âœ…${NC}"
EOF
    chmod +x /usr/local/bin/elite-x-uninstall
}

# ==================== CREATE PROFILE SCRIPT ====================
create_profile_script() {
    cat > /etc/profile.d/elite-x-dashboard.sh <<'EOF'
#!/bin/bash
if [ -f /usr/local/bin/elite-x ] && [ -z "$ELITE_X_SHOWN" ]; then
    export ELITE_X_SHOWN=1
    rm -f /tmp/elite-x-running 2>/dev/null
    /usr/local/bin/elite-x
fi
EOF
    chmod +x /etc/profile.d/elite-x-dashboard.sh
}

# ==================== MAIN INSTALLATION ====================
show_banner

# ACTIVATION
echo -e "${NEON_YELLOW}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_GREEN}${BOLD}                 QUANTUM ACTIVATION REQUIRED                       ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -e "${NEON_WHITE}Available Quantum Keys:${NC}"
echo -e "${NEON_GOLD}  ğŸ’ QUANTUM PREMIUM : Whtsapp +255713-628-668${NC}"
echo -e "${NEON_SILVER}  â³ QUANTUM TRIAL   : ELITE-X-ULTIMATE-TEST-0208 (2 days)${NC}"
echo ""
echo -ne "${NEON_CYAN}ğŸ”‘ Quantum Activation Key: ${NC}"
read ACTIVATION_INPUT

mkdir -p /etc/elite-x
if ! activate_script "$ACTIVATION_INPUT"; then
    echo -e "${NEON_RED}âŒ Invalid quantum key! Installation cancelled.${NC}"
    exit 1
fi

echo -e "${NEON_GREEN}âœ… Quantum activation successful!${NC}"
sleep 1

set_timezone

# SUBDOMAIN
echo -e "${NEON_CYAN}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_CYAN}â•‘${NEON_WHITE}${BOLD}              ENTER YOUR QUANTUM SUBDOMAIN                        ${NEON_CYAN}â•‘${NC}"
echo -e "${NEON_CYAN}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${NEON_CYAN}â•‘${NEON_WHITE}  Example: quantum.elitex.sbs                               ${NEON_CYAN}â•‘${NC}"
echo -e "${NEON_CYAN}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -ne "${NEON_GREEN}ğŸŒ Quantum Subdomain: ${NC}"
read TDOMAIN
echo "$TDOMAIN" > /etc/elite-x/subdomain

# LOCATION
echo -e "${NEON_YELLOW}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_GREEN}${BOLD}           QUANTUM LOCATION OPTIMIZATION                        ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_WHITE}  Select your VPS location:                                   ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_GREEN}  [1] South Africa (MTU 1800)                                 ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_CYAN}  [2] USA                                                      ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_BLUE}  [3] Europe                                                   ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_PURPLE}  [4] Asia                                                     ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_PINK}  [5] Auto-detect                                               ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•‘${NEON_RED}${BLINK}  [6] ğŸš€ QUANTUM ULTRA MODE (MAXIMUM SPEED)                  ${NEON_YELLOW}â•‘${NC}"
echo -e "${NEON_YELLOW}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
echo ""
echo -ne "${NEON_GREEN}Select quantum location [1-6] [default: 6]: ${NC}"
read LOCATION_CHOICE
LOCATION_CHOICE=${LOCATION_CHOICE:-6}

MTU=1800
SELECTED_LOCATION="South Africa"

case $LOCATION_CHOICE in
    2) SELECTED_LOCATION="USA"; echo -e "${NEON_CYAN}âœ… USA selected${NC}" ;;
    3) SELECTED_LOCATION="Europe"; echo -e "${NEON_BLUE}âœ… Europe selected${NC}" ;;
    4) SELECTED_LOCATION="Asia"; echo -e "${NEON_PURPLE}âœ… Asia selected${NC}" ;;
    5) SELECTED_LOCATION="Auto-detect"; echo -e "${NEON_PINK}âœ… Auto-detect selected${NC}" ;;
    6) SELECTED_LOCATION="QUANTUM ULTRA MODE"; echo -e "${NEON_RED}${BLINK}âœ… QUANTUM ULTRA MODE SELECTED - MAXIMUM SPEED${NC}" ;;
    *) SELECTED_LOCATION="South Africa"; echo -e "${NEON_GREEN}âœ… Using South Africa configuration${NC}" ;;
esac

echo "$SELECTED_LOCATION" > /etc/elite-x/location
echo "$MTU" > /etc/elite-x/mtu

DNSTT_PORT=5300

echo -e "${NEON_YELLOW}==> ELITE-X QUANTUM ULTIMATE INSTALLATION STARTING...${NC}"

if [ "$(id -u)" -ne 0 ]; then
  echo -e "${NEON_RED}[-] Run as root${NC}"
  exit 1
fi

# Clean previous installation
echo -e "${NEON_YELLOW}ğŸ§¹ Quantum cleaning previous installation...${NC}"
if [ -d "/etc/elite-x/users" ]; then
    for user_file in /etc/elite-x/users/*; do
        if [ -f "$user_file" ]; then
            username=$(basename "$user_file")
            pkill -u "$username" 2>/dev/null || true
            pkill -9 -u "$username" 2>/dev/null || true
            sleep 2
            userdel -f -r "$username" 2>/dev/null || true
        fi
    done
fi

systemctl stop dnstt-elite-x dnstt-elite-x-proxy 2>/dev/null || true
systemctl disable dnstt-elite-x dnstt-elite-x-proxy 2>/dev/null || true
rm -rf /etc/dnstt 2>/dev/null || true
rm -f /usr/local/bin/dnstt-server 2>/dev/null || true

mkdir -p /etc/elite-x/{banner,users,traffic,archive,profiles,neural,quantum,ai,predictive}
echo "$TDOMAIN" > /etc/elite-x/subdomain

# Create banners
cat > /etc/elite-x/banner/default <<'EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                  ELITE-X QUANTUM ULTIMATE VPN
          AI-Powered â€¢ Neural Optimized â€¢ Self-Healing
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF

cat > /etc/elite-x/banner/ssh-banner <<'EOF'
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                  ELITE-X QUANTUM ULTIMATE VPN
          AI-Powered â€¢ Neural Optimized â€¢ Self-Healing
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EOF

if ! grep -q "^Banner" /etc/ssh/sshd_config; then
    echo "Banner /etc/elite-x/banner/ssh-banner" >> /etc/ssh/sshd_config
else
    sed -i 's|^Banner.*|Banner /etc/elite-x/banner/ssh-banner|' /etc/ssh/sshd_config
fi
systemctl restart sshd

# Stop systemd-resolved to free port 53
systemctl stop systemd-resolved 2>/dev/null || true
systemctl disable systemd-resolved 2>/dev/null || true
fuser -k 53/udp 2>/dev/null || true

echo -e "${NEON_CYAN}Installing quantum dependencies...${NC}"
apt update -y
apt install -y curl python3 jq nano iptables iptables-persistent ethtool dnsutils net-tools iftop nload htop git make bc openssl netcat

# Install all components
install_dnstt_server
generate_quantum_keys
install_edns_proxy

# Setup all ultimate features
setup_ai_traffic_analyzer
setup_neural_optimizer
setup_quantum_encryption
setup_predictive_cache
setup_ddos_protection
setup_behavior_profiling
setup_self_healing
setup_auto_scaling
setup_ultimate_traffic_monitor
setup_ultimate_auto_remover
setup_ultimate_live_monitor
setup_ultimate_analyzer
setup_ultimate_renew
setup_ultimate_update
setup_ultimate_booster
setup_ultimate_refresh
setup_holographic_dashboard
setup_ultimate_user_manager
setup_ultimate_main_menu
create_uninstall_script
create_profile_script

# Create services
create_services "$TDOMAIN" "$MTU" "$DNSTT_PORT"

# Start all quantum services
echo -e "${NEON_CYAN}Starting quantum services...${NC}"

systemctl daemon-reload

for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic elite-x-cleaner \
               elite-x-ai elite-x-neural elite-x-quantum elite-x-predictive \
               elite-x-ddos elite-x-behavior elite-x-selfheal elite-x-autoscale; do
    systemctl enable $service 2>/dev/null || true
    systemctl start $service 2>/dev/null || true
    sleep 1
done

# Firewall
command -v ufw >/dev/null && {
    ufw allow 22/tcp
    ufw allow 53/udp
    ufw reload 2>/dev/null || true
}

# Create cron jobs
cat > /etc/cron.hourly/elite-x-expiry <<'EOF'
#!/bin/bash
if [ -f /usr/local/bin/elite-x ]; then
    /usr/local/bin/elite-x --check-expiry
fi
EOF
chmod +x /etc/cron.hourly/elite-x-expiry

# Add aliases
cat >> ~/.bashrc <<'EOF'
alias quantum='elite-x'
alias elite='elite-x'
alias quser='elite-x-user'
alias qlive='elite-x-live'
alias qai='elite-x-ai'
alias qhealth='elite-x-health'
alias qhologram='elite-x-hologram'
EOF

# Cache network info
/usr/local/bin/elite-x-refresh

# Final output
clear
show_banner
echo -e "${NEON_GOLD}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_GREEN}${BOLD}              ELITE-X QUANTUM ULTIMATE INSTALLED SUCCESSFULLY!                 ${NEON_GOLD}â•‘${NC}"
echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“Œ DOMAIN  : ${NEON_CYAN}${TDOMAIN}${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ“ LOCATION: ${NEON_CYAN}${SELECTED_LOCATION}${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ”‘ KEY     : ${NEON_YELLOW}$(cat /etc/elite-x/key)${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸ”‘ QUANTUM KEY: ${NEON_PURPLE}$(cat /etc/elite-x/quantum.key | head -c20)...${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  â³ EXPIRY  : ${NEON_YELLOW}$(cat /etc/elite-x/expiry)${NC}"
echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  ğŸš€ QUANTUM ULTIMATE FEATURES:${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ AI-Powered Traffic Analysis with Predictions${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Neural Network Optimization${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Quantum Encryption Simulation${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Self-Healing System with Auto-Recovery${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ DDoS Protection with Auto-Blocking${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Behavior Profiling & Anomaly Detection${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Auto-Scaling Connection Pool${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Predictive Caching Algorithm${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Holographic Dashboard with 3D Effects${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}     âœ“ Quantum User Management with AI${NC}"
echo -e "${NEON_GOLD}â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£${NC}"
echo -e "${NEON_GOLD}â•‘${NEON_WHITE}  Commands: quantum, elite, quser, qlive, qai, qhologram${NC}"
echo -e "${NEON_GOLD}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${NC}"
show_quote

# Service status
sleep 2
echo -e "${NEON_CYAN}Quantum Service Status:${NC}"
for service in dnstt-elite-x dnstt-elite-x-proxy elite-x-traffic elite-x-ai elite-x-quantum; do
    if systemctl is-active $service >/dev/null 2>&1; then
        echo -e "  ${NEON_GREEN}â—${NC} $service: ${NEON_GREEN}Running${NC}"
    else
        echo -e "  ${NEON_RED}â—${NC} $service: ${NEON_RED}Stopped${NC}"
    fi
done

echo ""
echo -e "${NEON_GREEN}Opening Quantum Dashboard in 3 seconds...${NC}"
sleep 3
/usr/local/bin/elite-x

self_destruct
